
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Getting Started with baseflow recession analysis</title><meta name="generator" content="MATLAB 9.9"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2022-11-07"><meta name="DC.source" content="bfra_gettingStarted.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>Getting Started with baseflow recession analysis</h1><!--introduction--><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Description</a></li><li><a href="#2">Download</a></li><li><a href="#3">Authors &amp; Sources</a></li><li><a href="#4">System Requirements</a></li><li><a href="#5">Features</a></li><li><a href="#6">Installation</a></li><li><a href="#7">Examples</a></li><li><a href="#8">Detect recession events from a timeseries of daily streamflow</a></li><li><a href="#10">Fit recession events</a></li><li><a href="#13">Global fit</a></li></ul></div><h2 id="1">Description</h2><p>Baseflow recession analysis refers to a set of methods in hydrologic science designed to infer aquifer properties that cannot be observed, such as hydraulic conductivity, from something that can be observed - streamflow. This toolbox provides easy-to-use functions to conduct baseflow recession analysis using measured values of streamflow recorded on a daily timestep. Its application here is meant for shallow (depth &lt;&lt; breadth) unconfined riparian aquifers that discharge subsurface flow into adjacent stream channels.</p><h2 id="2">Download</h2><p>Clone or fork the repository from <a href="https://github.com/mgcooper/baseflow">https://github.com/mgcooper/baseflow</a></p><h2 id="3">Authors &amp; Sources</h2><p>The code was written by Matt Cooper (<a href="mailto:matt.cooper@pnnl.gov">matt.cooper@pnnl.gov</a>) with some code borrowed from Clement Roques' exponential time step matlab code (available on request from Clement).</p><p>The underlying theory is based on idealized solutions to the one-dimensional (lateral) groundwater flow equation ("Boussinesq equation"). Details can be found in the following papers:</p><div><ul><li>Brutsaert W and Nieber J L 1977 Regionalized drought flow hydrographs from a mature glaciated plateau Water Resour. Res. 13 637&#8211;43.</li><li>Brutsaert W and Lopez J P 1998 Basin-scale geohydrologic drought flow features of riparian aquifers in the Southern Great Plains Water Resour. Res. 34 233&#8211;40.</li><li>Rupp D E and Selker J S 2006 On the use of the Boussinesq equation for interpreting recession hydrographs from sloping aquifers Water Resour. Res. 42 W12421.</li></ul></div><h2 id="4">System Requirements</h2><p>This toolbox depends on the following Mathworks products: Statistics and Machine Learning Toolbox <a href="https://www.mathworks.com/products/statistics.html">https://www.mathworks.com/products/statistics.html</a> Curve Fitting Toolbox <a href="https://www.mathworks.com/products/curvefitting.html">https://www.mathworks.com/products/curvefitting.html</a></p><h2 id="5">Features</h2><p>The toolbox supports three primary features:</p><div><ol><li>Recession (baseflow) event detection</li><li>Recession event fitting</li><li>Population (distribution) fitting</li></ol></div><p>Functions that support event detection:</p><div><ul><li>Get a list of all events  (<tt>bfra.getevents</tt>)</li><li>Get a cell array of all events (<tt>bfra.findevents</tt>)</li><li>Find events on an array of flow data (<tt>bfra.eventfinder</tt>)</li><li>Pick events manually (<tt>bfra.eventpicker</tt>)</li><li>Plot events (<tt>bfra.eventplotter</tt>)</li></ul></div><p>Functions that support event fitting: * <tt>bfra.fitevents</tt> * <tt>bfra.fitets</tt></p><pre>All user accessible functions in this toolbox are defined inside the 'bfra'
package. This avoids naming conflicts with built-in matlab functions or any
other namespace collision due to user-defined functions. Functions inside
bfra.internal are not meant to be called directly.</pre><pre>+bfra/  - The package, with all user accessible functions
docs/ - Documentation
demos/ - Example scripts
utils/ - Utility functions required for the package</pre><h2 id="6">Installation</h2><p>Place all files and folders in their own folder (e.g. baseflow) and then add that folder to your Matlab search path. Alternatively, run the included <tt>Setup.m</tt> installation script.</p><h2 id="7">Examples</h2><p>These examples provide an introduction to the toolbox. The <tt>demos</tt> folder contains additional scripts with examples.</p><h2 id="8">Detect recession events from a timeseries of daily streamflow</h2><pre class="codeinput">load <span class="string">dailyflow.mat</span>
Events = bfra.getevents(T,Q,R);
</pre><p>The output structure Events contains arrays that are the same size as the input time <tt>T</tt>, streamflow <tt>Q</tt>, and rainfall <tt>R</tt> arrays, but all non-recession flows are set nan.</p><h2 id="10">Fit recession events</h2><p>We pass the Events structure to <tt>bfra.fitevents</tt> which cycles over each individual recession event and fits a curve to estimate the paramaters.</p><pre class="codeinput">[Fit,K] = bfra.fitevents(Events);
</pre><p>The output structure <tt>Fits</tt> is similar to the input <tt>Events</tt>, except that the streamflow data has been fit using an exponential timestep to reduce the impact of measurement noise on the measured data. In addition, the rate of change of streamflow, dQ/dt, is included.</p><p>The output table <tt>K</tt> contains the parameters of the fit to each individual recession event. These parameters form the basis for subsequent analysis.</p><h2 id="13">Global fit</h2><p>Once the individual events have been fit, we conduct inference testing on the sample population.</p><p>First we transform the observed streamflow data into a timescale parameter tau using the fitted parameters in <tt>K</tt></p><pre class="codeinput">[tau,q,dqdt,tags] = bfra.eventtau(K,Events,Fits,<span class="string">'usefits'</span>,false);

<span class="comment">% Then we pass that into a custom Pareto distribution fitting routine to</span>
<span class="comment">% estimate the sample-population-scale value of the parameters a and b:</span>
TauFit = bfra.plfitb(tau,<span class="string">'plot'</span>,plotfits,<span class="string">'boot'</span>,false);
</pre><pre class="codeoutput error">Unrecognized function or variable 'Fits'.

Error in bfra_gettingStarted (line 116)
[tau,q,dqdt,tags] = bfra.eventtau(K,Events,Fits,'usefits',false);
</pre><p>The <tt>TauFit</tt> structure contains information about the Pareto Distribution fit including the minimum bound, tau0, the expected value, tau, and the parameter estimate bhat.</p><pre class="codeinput">TauFit.tau0
TauFit.tau
TauFit.bhat
</pre><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2020b</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Getting Started with baseflow recession analysis
%% Description
% Baseflow recession analysis refers to a set of methods in hydrologic science
% designed to infer aquifer properties that cannot be observed, such as
% hydraulic conductivity, from something that can be observed - streamflow. This
% toolbox provides easy-to-use functions to conduct baseflow recession analysis
% using measured values of streamflow recorded on a daily timestep. Its 
% application here is meant for shallow (depth << breadth) unconfined riparian
% aquifers that discharge subsurface flow into adjacent stream channels. 
% 
%% Download 
% Clone or fork the repository from <https://github.com/mgcooper/baseflow>
%
%% Authors & Sources
% The code was written by Matt Cooper (matt.cooper@pnnl.gov) with some code
% borrowed from Clement Roques' exponential time step matlab code (available on
% request from Clement).
% 
% The underlying theory is based on idealized solutions to the one-dimensional
% (lateral) groundwater flow equation ("Boussinesq equation"). Details can be
% found in the following papers:
% 
% *  Brutsaert W and Nieber J L 1977 Regionalized drought flow hydrographs from
% a mature glaciated plateau Water Resour. Res. 13 637–43.
% *  Brutsaert W and Lopez J P 1998 Basin-scale geohydrologic drought flow
% features of riparian aquifers in the Southern Great Plains Water Resour. Res.
% 34 233–40.
% *  Rupp D E and Selker J S 2006 On the use of the Boussinesq equation for
% interpreting recession hydrographs from sloping aquifers Water Resour. Res. 42
% W12421.
% 
%% System Requirements 
% This toolbox depends on the following Mathworks products:  
% Statistics and Machine Learning Toolbox 
% <https://www.mathworks.com/products/statistics.html> 
% Curve Fitting Toolbox 
% <https://www.mathworks.com/products/curvefitting.html> 
% 
%% Features
% The toolbox supports three primary features:
% 
% # Recession (baseflow) event detection
% # Recession event fitting
% # Population (distribution) fitting
% 
% Functions that support event detection:
% 
% * Get a list of all events  (|bfra.getevents|)
% * Get a cell array of all events (|bfra.findevents|)
% * Find events on an array of flow data (|bfra.eventfinder|)
% * Pick events manually (|bfra.eventpicker|)
% * Plot events (|bfra.eventplotter|)
% 
% Functions that support event fitting:
% * |bfra.fitevents|
% * |bfra.fitets|
% 
% 
% 
%  All user accessible functions in this toolbox are defined inside the 'bfra'
%  package. This avoids naming conflicts with built-in matlab functions or any
%  other namespace collision due to user-defined functions. Functions inside
%  bfra.internal are not meant to be called directly. 
%  
%  +bfra/  - The package, with all user accessible functions
%  docs/ - Documentation
%  demos/ - Example scripts
%  utils/ - Utility functions required for the package
%
%% Installation
% 
% Place all files and folders in their own folder (e.g. baseflow) and then add
% that folder to your Matlab search path. Alternatively, run the included
% |Setup.m| installation script.
%
%% Examples
% These examples provide an introduction to the toolbox. The |demos| folder
% contains additional scripts with examples.
%

%% Detect recession events from a timeseries of daily streamflow

load dailyflow.mat
Events = bfra.getevents(T,Q,R);

%% 
% The output structure Events contains arrays that are the same size as the
% input time |T|, streamflow |Q|, and rainfall |R| arrays, but all non-recession
% flows are set nan. 
% 
%% Fit recession events
% We pass the Events structure to |bfra.fitevents| which cycles over each
% individual recession event and fits a curve to estimate the paramaters.

[Fit,K] = bfra.fitevents(Events);

%% 
% The output structure |Fits| is similar to the input |Events|, except that the
% streamflow data has been fit using an exponential timestep to reduce the
% impact of measurement noise on the measured data. In addition, the rate of
% change of streamflow, dQ/dt, is included.

%% 
% The output table |K| contains the parameters of the fit to each individual
% recession event. These parameters form the basis for subsequent analysis.
% 
%% Global fit
% Once the individual events have been fit, we conduct inference testing on the
% sample population. 


%% 
% First we transform the observed streamflow data into a timescale parameter tau
% using the fitted parameters in |K|

[tau,q,dqdt,tags] = bfra.eventtau(K,Events,Fits,'usefits',false);

% Then we pass that into a custom Pareto distribution fitting routine to
% estimate the sample-population-scale value of the parameters a and b:
TauFit = bfra.plfitb(tau,'plot',plotfits,'boot',false);

%% 
% The |TauFit| structure contains information about the Pareto Distribution fit
% including the minimum bound, tau0, the expected value, tau, and the
% parameter estimate bhat.
% 


TauFit.tau0
TauFit.tau
TauFit.bhat

##### SOURCE END #####
--></body></html>