<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of setopts</title>
  <meta name="keywords" content="setopts">
  <meta name="description" content="SETOPTS set algorithm options for functions getevents, fitevents, and globalfit">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../function_index.html">Home</a> &gt;  <a href="function_index.html">+bfra</a> &gt; setopts.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../function_index.html"><img alt="<" border="0" src="../html_img/left.png">&nbsp;Master index</a></td>
<td align="right"><a href="function_index.html">Index for +bfra&nbsp;<img alt=">" border="0" src="../html_img/right.png"></a></td></tr></table>-->

<h1>setopts
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../html_img/up.png"></a></h2>
<div class="box"><strong>SETOPTS set algorithm options for functions getevents, fitevents, and globalfit</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../html_img/up.png"></a></h2>
<div class="box"><strong>function opts = setopts(funcname,varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../html_img/up.png"></a></h2>
<div class="fragment"><pre class="comment">SETOPTS set algorithm options for functions getevents, fitevents, and globalfit

  Required inputs

     funcname    : 'getevents', 'fitevents', or 'globalfit'

     indicates whether to send back the default options for the event detection
     algorithm 'getevents', the event fitting algorithm 'fitdqdt', or the
     global fitting algorithm 'globalfit'

  Optional name-value inputs for type 'getevents'

     opts        :  structure containing any of the following fields

     qmin        :  minimum flow value, below which values are set nan (m3/d)
     nmin        :  minimum event length
     fmax        :  maximum # of missing values gap-filled
     rmax        :  maximum runlength of sequential constant values
     rmin        :  maximum allowable rainfall in mm/d 
     cmax        :  maximum run of sequential convex dQ/dt values
     rmconvex    :  remove convex derivatives
     rmnochange  :  remove consecutive constant derivates
     rmrain      :  remove data on days with rainfall&gt;rmin
     pickevents  :  option to manually pick events
     plotevents  :  option to plot picked events

  Optional name-value inputs for type 'fitevents'
 
     derivmethod    : derivative (dQ/dt) method
     fitmethod      : -dQ/dt = aQb fitting method
     fitorder       : fitting order (value of exponent b)
     fitnmin        : minimum number of values required to fit -dQ/dt = aQb 
     pickfits       : pick fits manually?
     pickmethod     : method to fit picks manually
     plotfits       : plot the fits?
     savefitplots   : save plots of fits?
     etsparam       : min flow length parameter for ETS algorithm
     vtsparam       : min flow length parameter for VTS algorithm
     drainagearea   : drainage area in m2
     gageID         : station name or ID
 
  Optional name-value inputs for type 'globalfit'
 
     drainagearea   : drainage area [m2]
     drainagedens   : drainage density [km-1] = streamlenght/drainagearea
     aquiferdepth   : reference aquifer thickness [m]
     streamlength   : effective channel length [m]
     aquiferslope   : effective aquifer slope
     aquiferbreadth : distance from channel to divide
     isflat         : logical indicating true or false
     plotfits       : plot the various global fits?e
     bootfit        : logical indicating whether to bootstrap the uncertainites
     nreps          : number of reps for bootstrapping 
     phimethod      : method used to fit drainable porosity
     refqtls        : quantiles of Q and -dQ/dt for early/late reference lines
     earlyqtls      : quantiles of Q and -dQ/dt for early reference lines
     lateqtls       : quantiles of Q and -dQ/dt for late reference lines

  See also getfits, fitdqdt

  Matt Cooper, 22-Oct-2022, https://github.com/mgcooper</pre></div>


<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../html_img/up.png"></a></h2>

This function calls:
<ul style="list-style-image:url(../html_img/matlabicon.gif)">
</ul>


This function is called by:
<ul style="list-style-image:url(../html_img/matlabicon.gif)">
</ul>
<!-- crossreference -->






<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../html_img/up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function opts = setopts(funcname,varargin)</a>
0002 <span class="comment">%SETOPTS set algorithm options for functions getevents, fitevents, and globalfit</span>
0003 <span class="comment">%</span>
0004 <span class="comment">%  Required inputs</span>
0005 <span class="comment">%</span>
0006 <span class="comment">%     funcname    : 'getevents', 'fitevents', or 'globalfit'</span>
0007 <span class="comment">%</span>
0008 <span class="comment">%     indicates whether to send back the default options for the event detection</span>
0009 <span class="comment">%     algorithm 'getevents', the event fitting algorithm 'fitdqdt', or the</span>
0010 <span class="comment">%     global fitting algorithm 'globalfit'</span>
0011 <span class="comment">%</span>
0012 <span class="comment">%  Optional name-value inputs for type 'getevents'</span>
0013 <span class="comment">%</span>
0014 <span class="comment">%     opts        :  structure containing any of the following fields</span>
0015 <span class="comment">%</span>
0016 <span class="comment">%     qmin        :  minimum flow value, below which values are set nan (m3/d)</span>
0017 <span class="comment">%     nmin        :  minimum event length</span>
0018 <span class="comment">%     fmax        :  maximum # of missing values gap-filled</span>
0019 <span class="comment">%     rmax        :  maximum runlength of sequential constant values</span>
0020 <span class="comment">%     rmin        :  maximum allowable rainfall in mm/d</span>
0021 <span class="comment">%     cmax        :  maximum run of sequential convex dQ/dt values</span>
0022 <span class="comment">%     rmconvex    :  remove convex derivatives</span>
0023 <span class="comment">%     rmnochange  :  remove consecutive constant derivates</span>
0024 <span class="comment">%     rmrain      :  remove data on days with rainfall&gt;rmin</span>
0025 <span class="comment">%     pickevents  :  option to manually pick events</span>
0026 <span class="comment">%     plotevents  :  option to plot picked events</span>
0027 <span class="comment">%</span>
0028 <span class="comment">%  Optional name-value inputs for type 'fitevents'</span>
0029 <span class="comment">%</span>
0030 <span class="comment">%     derivmethod    : derivative (dQ/dt) method</span>
0031 <span class="comment">%     fitmethod      : -dQ/dt = aQb fitting method</span>
0032 <span class="comment">%     fitorder       : fitting order (value of exponent b)</span>
0033 <span class="comment">%     fitnmin        : minimum number of values required to fit -dQ/dt = aQb</span>
0034 <span class="comment">%     pickfits       : pick fits manually?</span>
0035 <span class="comment">%     pickmethod     : method to fit picks manually</span>
0036 <span class="comment">%     plotfits       : plot the fits?</span>
0037 <span class="comment">%     savefitplots   : save plots of fits?</span>
0038 <span class="comment">%     etsparam       : min flow length parameter for ETS algorithm</span>
0039 <span class="comment">%     vtsparam       : min flow length parameter for VTS algorithm</span>
0040 <span class="comment">%     drainagearea   : drainage area in m2</span>
0041 <span class="comment">%     gageID         : station name or ID</span>
0042 <span class="comment">%</span>
0043 <span class="comment">%  Optional name-value inputs for type 'globalfit'</span>
0044 <span class="comment">%</span>
0045 <span class="comment">%     drainagearea   : drainage area [m2]</span>
0046 <span class="comment">%     drainagedens   : drainage density [km-1] = streamlenght/drainagearea</span>
0047 <span class="comment">%     aquiferdepth   : reference aquifer thickness [m]</span>
0048 <span class="comment">%     streamlength   : effective channel length [m]</span>
0049 <span class="comment">%     aquiferslope   : effective aquifer slope</span>
0050 <span class="comment">%     aquiferbreadth : distance from channel to divide</span>
0051 <span class="comment">%     isflat         : logical indicating true or false</span>
0052 <span class="comment">%     plotfits       : plot the various global fits?e</span>
0053 <span class="comment">%     bootfit        : logical indicating whether to bootstrap the uncertainites</span>
0054 <span class="comment">%     nreps          : number of reps for bootstrapping</span>
0055 <span class="comment">%     phimethod      : method used to fit drainable porosity</span>
0056 <span class="comment">%     refqtls        : quantiles of Q and -dQ/dt for early/late reference lines</span>
0057 <span class="comment">%     earlyqtls      : quantiles of Q and -dQ/dt for early reference lines</span>
0058 <span class="comment">%     lateqtls       : quantiles of Q and -dQ/dt for late reference lines</span>
0059 <span class="comment">%</span>
0060 <span class="comment">%  See also getfits, fitdqdt</span>
0061 <span class="comment">%</span>
0062 <span class="comment">%  Matt Cooper, 22-Oct-2022, https://github.com/mgcooper</span>
0063 
0064 <span class="comment">% if called with no input, open this file</span>
0065 <span class="keyword">if</span> nargin == 0; open(mfilename(<span class="string">'fullpath'</span>)); <span class="keyword">return</span>; <span class="keyword">end</span>
0066 
0067 <span class="comment">%% set default bfra settings</span>
0068 
0069 p                 = inputParser;
0070 p.FunctionName    = <span class="string">'bfra.setopts'</span>;
0071 
0072 p.addRequired(<span class="string">'funcname'</span>,@(x)ischar(x));
0073 parse(p,funcname);
0074 
0075 <span class="keyword">switch</span> funcname
0076 
0077    <span class="comment">% event detection - input options for getevents</span>
0078    <span class="keyword">case</span> <span class="string">'getevents'</span>
0079 
0080       addParameter(p,   <span class="string">'qmin'</span>,        1,          @(x) isnumericscalar(x)  );
0081       addParameter(p,   <span class="string">'nmin'</span>,        4,          @(x) isnumericscalar(x)  );
0082       addParameter(p,   <span class="string">'fmax'</span>,        1,          @(x) isnumericscalar(x)  );
0083       addParameter(p,   <span class="string">'rmax'</span>,        2,          @(x) isnumericscalar(x)  );
0084       addParameter(p,   <span class="string">'rmin'</span>,        1,          @(x) isnumericscalar(x)  );
0085       addParameter(p,   <span class="string">'cmax'</span>,        2,          @(x) isnumericscalar(x)  );
0086       addParameter(p,   <span class="string">'rmconvex'</span>,    false,      @(x) islogicalscalar(x)  );
0087       addParameter(p,   <span class="string">'rmnochange'</span>,  true,       @(x) islogicalscalar(x)  );
0088       addParameter(p,   <span class="string">'rmrain'</span>,      true,       @(x) islogicalscalar(x)  );
0089       addParameter(p,   <span class="string">'pickevents'</span>,  false,      @(x) islogicalscalar(x)  );
0090       addParameter(p,   <span class="string">'plotevents'</span>,  false,      @(x) islogicalscalar(x)  );
0091 
0092    <span class="comment">% event fits - input options for fitevents</span>
0093    <span class="keyword">case</span> <span class="string">'fitevents'</span>
0094 
0095       addParameter(p,   <span class="string">'derivmethod'</span>, <span class="string">'ETS'</span>,      @(x) ischar(x)             );
0096       addParameter(p,   <span class="string">'fitmethod'</span>,   <span class="string">'nls'</span>,      @(x) ischar(x)             );
0097       addParameter(p,   <span class="string">'fitorder'</span>,    <span class="string">'free'</span>,     @(x) ischar(x)|isnumeric(x));
0098       addParameter(p,   <span class="string">'pickfits'</span>,    false,      @(x) islogicalscalar(x)    );
0099       addParameter(p,   <span class="string">'pickmethod'</span>,  <span class="string">'none'</span>,     @(x) ischar(x)             );
0100       addParameter(p,   <span class="string">'plotfits'</span>,    false,      @(x) islogicalscalar(x)    );
0101       addParameter(p,   <span class="string">'saveplots'</span>,   false,      @(x) islogicalscalar(x)    );
0102       addParameter(p,   <span class="string">'etsparam'</span>,    0.2,        @(x) isnumericscalar(x)    );
0103       addParameter(p,   <span class="string">'vtsparam'</span>,    1.0,        @(x) isnumericscalar(x)    );
0104       
0105    <span class="comment">% global fit - input to bfra.globalfit</span>
0106    <span class="keyword">case</span> <span class="string">'globalfit'</span>
0107 
0108       addParameter(p,   <span class="string">'drainagearea'</span>,   nan,           @(x)isnumericscalar(x)  );
0109       addParameter(p,   <span class="string">'drainagedens'</span>,   0.8,           @(x)isnumericscalar(x)  );
0110       addParameter(p,   <span class="string">'aquiferdepth'</span>,   nan,           @(x)isnumericscalar(x)  );
0111       addParameter(p,   <span class="string">'streamlength'</span>,   nan,           @(x)isnumericscalar(x)  );
0112       addParameter(p,   <span class="string">'aquiferslope'</span>,   nan,           @(x)isnumericscalar(x)  );
0113       addParameter(p,   <span class="string">'aquiferbreadth'</span>, nan,           @(x)isnumericscalar(x)  );
0114       addParameter(p,   <span class="string">'isflat'</span>,         true,          @(x)islogicalscalar(x)  );
0115       addParameter(p,   <span class="string">'plotfits'</span>,       false,         @(x)islogicalscalar(x)  );
0116       addParameter(p,   <span class="string">'bootfit'</span>,        false,         @(x)islogicalscalar(x)  );
0117       addParameter(p,   <span class="string">'nreps'</span>,          1000,          @(x)isdoublescalar(x)   );
0118       addParameter(p,   <span class="string">'phimethod'</span>,      <span class="string">'pointcloud'</span>,  @(x)ischar(x)           );
0119       addParameter(p,   <span class="string">'refqtls'</span>,        [0.50 0.50],   @(x)isnumericvector(x)  );
0120       addParameter(p,   <span class="string">'earlyqtls'</span>,      [0.95 0.95],   @(x)isnumericvector(x)  );
0121       addParameter(p,   <span class="string">'lateqtls'</span>,       [0.50 0.50],   @(x)isnumericvector(x)  );
0122 
0123 <span class="keyword">end</span>
0124 
0125 parse(p,funcname,varargin{:});
0126 
0127 opts = p.Results;
0128 opts = rmfield(opts,<span class="string">'funcname'</span>);
0129</pre></div>
</body>
</html>