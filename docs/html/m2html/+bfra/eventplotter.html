<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of eventplotter</title>
  <meta name="keywords" content="eventplotter">
  <meta name="description" content="EVENTPLOTTER plot recession events detected by eventfinder">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../function_index.html">Home</a> &gt;  <a href="function_index.html">+bfra</a> &gt; eventplotter.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../function_index.html"><img alt="<" border="0" src="../html_img/left.png">&nbsp;Master index</a></td>
<td align="right"><a href="function_index.html">Index for +bfra&nbsp;<img alt=">" border="0" src="../html_img/right.png"></a></td></tr></table>-->

<h1>eventplotter
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../html_img/up.png"></a></h2>
<div class="box"><strong>EVENTPLOTTER plot recession events detected by eventfinder</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../html_img/up.png"></a></h2>
<div class="box"><strong>function [h,f] = eventplotter(T,Q,R,Info,varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../html_img/up.png"></a></h2>
<div class="fragment"><pre class="comment">EVENTPLOTTER plot recession events detected by eventfinder

 Syntax

     h = eventplotter(t,q,r,Info,varargin)

 Description

     h = eventplotter(t,q,r,Info) Plots recession events identified by
     eventfinder on hydrograph t,q and rainfall r. Info is a structure returned
     by eventfinder that contains the indices of the start and end of each
     event as well as the local peaks, minimums, and runlength. An option to
     plot dq/dt as positive or negative values is available.

 Required inputs

     T        time
     Q        flow (m3/time)
     R        rain (mm/time)
     Info     Info structure returned by findevents.m

 Optional name-value inputs

  dqdt: user-provided dqdt, default = centered finite diff
  plotevents: logical, name-value e.g. 'plotevents',true
  plotneg: logical, name-value

 See also <a href="getevents.html" class="code" title="function [Events,Info] = getevents(T,Q,R,varargin)">getevents</a>, <a href="eventfinder.html" class="code" title="function [T,Q,R,Info] = eventfinder(t,q,r,varargin)">eventfinder</a>, <a href="eventpicker.html" class="code" title="function [T,Q,R,Info] = eventpicker(t,q,r,nmin,Info)">eventpicker</a>, <a href="eventsplitter.html" class="code" title="function [T,Q,R,Info] = eventsplitter(t,q,r,varargin)">eventsplitter</a>

 Matt Cooper, 04-Nov-2022, https://github.com/mgcooper</pre></div>


<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../html_img/up.png"></a></h2>

This function calls:
<ul style="list-style-image:url(../html_img/matlabicon.gif)">
</ul>


This function is called by:
<ul style="list-style-image:url(../html_img/matlabicon.gif)">
</ul>
<!-- crossreference -->






<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../html_img/up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [h,f] = eventplotter(T,Q,R,Info,varargin)</a>
0002 <span class="comment">%EVENTPLOTTER plot recession events detected by eventfinder</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% Syntax</span>
0005 <span class="comment">%</span>
0006 <span class="comment">%     h = eventplotter(t,q,r,Info,varargin)</span>
0007 <span class="comment">%</span>
0008 <span class="comment">% Description</span>
0009 <span class="comment">%</span>
0010 <span class="comment">%     h = eventplotter(t,q,r,Info) Plots recession events identified by</span>
0011 <span class="comment">%     eventfinder on hydrograph t,q and rainfall r. Info is a structure returned</span>
0012 <span class="comment">%     by eventfinder that contains the indices of the start and end of each</span>
0013 <span class="comment">%     event as well as the local peaks, minimums, and runlength. An option to</span>
0014 <span class="comment">%     plot dq/dt as positive or negative values is available.</span>
0015 <span class="comment">%</span>
0016 <span class="comment">% Required inputs</span>
0017 <span class="comment">%</span>
0018 <span class="comment">%     T        time</span>
0019 <span class="comment">%     Q        flow (m3/time)</span>
0020 <span class="comment">%     R        rain (mm/time)</span>
0021 <span class="comment">%     Info     Info structure returned by findevents.m</span>
0022 <span class="comment">%</span>
0023 <span class="comment">% Optional name-value inputs</span>
0024 <span class="comment">%</span>
0025 <span class="comment">%  dqdt: user-provided dqdt, default = centered finite diff</span>
0026 <span class="comment">%  plotevents: logical, name-value e.g. 'plotevents',true</span>
0027 <span class="comment">%  plotneg: logical, name-value</span>
0028 <span class="comment">%</span>
0029 <span class="comment">% See also getevents, eventfinder, eventpicker, eventsplitter</span>
0030 <span class="comment">%</span>
0031 <span class="comment">% Matt Cooper, 04-Nov-2022, https://github.com/mgcooper</span>
0032 
0033 <span class="comment">% if called with no input, open this file</span>
0034 <span class="keyword">if</span> nargin == 0; open(mfilename(<span class="string">'fullpath'</span>)); <span class="keyword">return</span>; <span class="keyword">end</span>
0035 
0036 <span class="comment">%-------------------------------------------------------------------------------</span>
0037 <span class="comment">% input handling</span>
0038 p              = inputParser;
0039 p.FunctionName = <span class="string">'eventplotter'</span>;
0040 
0041 N = numel(Info.istart);
0042 
0043 addRequired(p, <span class="string">'T'</span>,                    @(x) isnumeric(x) | isdatetime(x)      );
0044 addRequired(p, <span class="string">'Q'</span>,                    @(x) isnumeric(x) &amp; numel(x)==numel(T) );
0045 addRequired(p, <span class="string">'R'</span>,                    @(x) isnumeric(x)                      );
0046 addRequired(p, <span class="string">'Info'</span>,                 @(x) isstruct(x)                       );
0047 addOptional(p, <span class="string">'eventTags'</span>,   1:N,     @(x) isnumericvector(x)                );
0048 addParameter(p,<span class="string">'plotneg'</span>,     false,   @(x) islogical(x) &amp; isscalar(x)        );
0049 addParameter(p,<span class="string">'plotevents'</span>,  false,   @(x) islogical(x) &amp; isscalar(x)        );
0050 addParameter(p,<span class="string">'dqdt'</span>,   derivative(Q),@(x) isnumeric(x) &amp; numel(x)==numel(T) );
0051 
0052 parse(p,T,Q,R,Info,varargin{:});
0053 
0054 eventTags   = p.Results.eventTags;
0055 plotneg     = p.Results.plotneg;
0056 plotevents  = p.Results.plotevents;
0057 dqdt        = p.Results.dqdt;
0058 <span class="comment">%-------------------------------------------------------------------------------</span>
0059 
0060 <span class="comment">% short circuits</span>
0061 <span class="keyword">if</span> plotevents == false; h = []; <span class="keyword">return</span>; <span class="keyword">end</span>
0062 <span class="keyword">if</span> isempty(Info.istart); disp(<span class="string">'no valid events'</span>); h = []; <span class="keyword">return</span>; <span class="keyword">end</span>
0063 
0064 <span class="comment">% otherwise, prep the data to plot</span>
0065 
0066 sz = 20; <span class="comment">% this controls the size of the scatter symbols</span>
0067 
0068 <span class="comment">% compute the second derivative and the increasing/decreasing values. do this</span>
0069 <span class="comment">% here so the indices are relative to the same T,Q vectors as the Info indices</span>
0070 d2qdt = derivative(dqdt);
0071 Info.ipositive = find(dqdt&gt;=0);
0072 Info.inegative = find(dqdt&lt;0);
0073 
0074 <span class="comment">% get the data for the requested events identified by their event tags</span>
0075 <span class="keyword">if</span> numel(eventTags) == N
0076    idx = 1:numel(T); <span class="comment">% all events were requested</span>
0077 <span class="keyword">else</span>
0078    <span class="comment">% create an index for the period of requested events padded by a week</span>
0079    idx = Info.istart(min(eventTags)):1:Info.istop(max(eventTags));
0080 
0081    <span class="comment">% this pads the indices by one week (or any other amount)</span>
0082    idx = [idx(1)-10:1:idx(1)-1 idx idx(end)+1:1:idx(end)+10];
0083 
0084    <span class="comment">% this uses all indices in the year(s) of this event(s)</span>
0085    <span class="comment">% idx = find(ismember(year(t),unique(year(t(idx)))));</span>
0086 <span class="keyword">end</span>
0087 
0088 fields = fieldnames(Info);
0089 <span class="keyword">for</span> n = 1:numel(fields)
0090    thisfield = Info.(fields{n});
0091    keep = ismember(thisfield,idx);
0092    Info.(fields{n}) = thisfield(keep);
0093 <span class="keyword">end</span>
0094 
0095 <span class="comment">% convert the first and second derivatives to positive values</span>
0096 <span class="keyword">if</span> plotneg == true
0097    dqdt = -dqdt;
0098    d2qdt = -d2qdt;
0099 <span class="keyword">end</span>
0100 
0101 <span class="comment">% fields to plot</span>
0102 plotfields = {<span class="string">'ipositive'</span>,<span class="string">'inegative'</span>,<span class="string">'imaxima'</span>,<span class="string">'iminima'</span>,<span class="string">'iconvex'</span>,<span class="string">'ikeep'</span>};
0103 
0104 <span class="comment">% turned this off so h is a gobjects array</span>
0105 <span class="comment">% h.Info = Info;</span>
0106 
0107 <span class="comment">% make the figure</span>
0108 <span class="comment">% h.f = figure('Position',[1,1,1152*2/3,616*2/3]);</span>
0109 f = figure(<span class="string">'Units'</span>,<span class="string">'inches'</span>,<span class="string">'Position'</span>,[1,1,8.5,5],<span class="string">'Visible'</span>,<span class="string">'on'</span>);
0110 <span class="comment">% tiledlayout(3,1,'TileSpacing','tight','Padding','tight');</span>
0111 
0112 <span class="comment">% plot the panels</span>
0113 <span class="keyword">for</span> m = 1:3
0114 
0115 <span class="comment">%    nexttile;</span>
0116    h.subplot(m) = subtight(3,1,m,<span class="string">'style'</span>,<span class="string">'fitted'</span>);
0117    h.ax(m) = gca; hold on;
0118 
0119    <span class="keyword">for</span> n = 1:numel(plotfields)
0120       
0121       thisfield = plotfields{n};
0122       ifield = Info.(thisfield);
0123    
0124       <span class="comment">% increase the plot symbol size depending on the field</span>
0125       <span class="keyword">switch</span> thisfield
0126          <span class="keyword">case</span> {<span class="string">'imaxima'</span>,<span class="string">'iminima'</span>}
0127             ssize = 2*sz;
0128          <span class="keyword">case</span> <span class="string">'ikeep'</span>
0129             ssize = 2.5*sz;
0130          <span class="keyword">otherwise</span>
0131             ssize = sz;
0132       <span class="keyword">end</span>
0133 
0134       <span class="keyword">switch</span> m
0135          <span class="keyword">case</span> 1 <span class="comment">% Q</span>
0136             h1.(thisfield) = scatter(h.ax(m),T(ifield),Q(ifield),ssize,<span class="string">'filled'</span>);
0137          <span class="keyword">case</span> 2 <span class="comment">% dQ/dt</span>
0138             h2.(thisfield) = scatter(h.ax(m),T(ifield),dqdt(ifield),ssize,<span class="string">'filled'</span>);
0139          <span class="keyword">case</span> 3 <span class="comment">% d2Q/dt2</span>
0140             h3.(thisfield) = scatter(h.ax(m),T(ifield),d2qdt(ifield),ssize,<span class="string">'filled'</span>);
0141       <span class="keyword">end</span>
0142       
0143    <span class="keyword">end</span>
0144 
0145    legend(<span class="string">'increasing'</span>,<span class="string">'decreasing'</span>,<span class="string">'maxima'</span>,<span class="string">'minima'</span>,<span class="string">'convex'</span>,<span class="string">'keep'</span>, <span class="keyword">...</span>
0146       <span class="string">'AutoUpdate'</span>,<span class="string">'off'</span>,<span class="string">'Orientation'</span>,<span class="string">'horizontal'</span>,<span class="string">'Location'</span>,<span class="string">'ne'</span>,<span class="keyword">...</span>
0147       <span class="string">'FontSize'</span>,10);
0148    
0149    set(gca,<span class="string">'FontSize'</span>,10)
0150 <span class="keyword">end</span>
0151 
0152 <span class="comment">% add labels</span>
0153 ylabel(h.ax(1),bfra.getstring(<span class="string">'Q'</span>,<span class="string">'units'</span>,true),<span class="string">'FontSize'</span>,10);
0154 ylabel(h.ax(2),bfra.getstring(<span class="string">'dQdt'</span>,<span class="string">'units'</span>,true),<span class="string">'FontSize'</span>,10);
0155 ylabel(h.ax(3),bfra.getstring(<span class="string">'d2Qdt2'</span>,<span class="string">'units'</span>,true),<span class="string">'FontSize'</span>,10);
0156 
0157 <span class="comment">% add a line at zero</span>
0158 h2.zeroline = plot(h.ax(2),xlim(h.ax(2)),[0 0],<span class="string">'k-'</span>,<span class="string">'LineWidth'</span>,1);
0159 h3.zeroline = plot(h.ax(3),xlim(h.ax(3)),[0 0],<span class="string">'k-'</span>,<span class="string">'LineWidth'</span>,1);
0160 
0161 h.h1 = h1;
0162 h.h2 = h2;
0163 h.h3 = h3;
0164 
0165 <span class="comment">% if ispublishing</span>
0166 <span class="comment">%    exportgraphics(gcf,'html/event_example.png','Resolution',400);</span>
0167 <span class="comment">% end</span>
0168 
0169 <span class="comment">% snapnow</span>
0170 
0171 <span class="comment">% % other options not in use</span>
0172 <span class="comment">% %</span>
0173 <span class="comment">% % plot the 50th percentile as a reference line</span>
0174 <span class="comment">% % q50 = quantile(q,0.5);</span>
0175 <span class="comment">% % h1.refline = hline(h.ax(1),q50,':'); % add the 50th quantile line</span>
0176 <span class="comment">%</span>
0177 <span class="comment">%</span>
0178 <span class="comment">% % plot the events identified by bfra.findevents, just to be sure</span>
0179 <span class="comment">% %     for i = 1:length(T)</span>
0180 <span class="comment">% %         h.s1g = scatter(T{i},Q{i},200,'r','LineWidth',2);</span>
0181 <span class="comment">% %     end</span>
0182 <span class="comment">% % h.l1 = legend('increasing','decreasing','maxima','minima','convex','keep','keep (check)');</span>
0183 <span class="comment">%</span>
0184 <span class="comment">% h.l1 = legend('increasing','decreasing','maxima','minima','convex','keep');</span>
0185 <span class="comment">% ylabel(bfra.getstring('Q','units',true));</span></pre></div>
</body>
</html>