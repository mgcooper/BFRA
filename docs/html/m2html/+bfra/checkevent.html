<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of checkevent</title>
  <meta name="keywords" content="checkevent">
  <meta name="description" content="CHECKEVENT plot detected recession event and fitted values">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../function_index.html">Home</a> &gt;  <a href="function_index.html">+bfra</a> &gt; checkevent.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../function_index.html"><img alt="<" border="0" src="../html_img/left.png">&nbsp;Master index</a></td>
<td align="right"><a href="function_index.html">Index for +bfra&nbsp;<img alt=">" border="0" src="../html_img/right.png"></a></td></tr></table>-->

<h1>checkevent
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../html_img/up.png"></a></h2>
<div class="box"><strong>CHECKEVENT plot detected recession event and fitted values</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../html_img/up.png"></a></h2>
<div class="box"><strong>function h = checkevent(T,Q,q,dqdt,r,alltags,eventtag,varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../html_img/up.png"></a></h2>
<div class="fragment"><pre class="comment">CHECKEVENT plot detected recession event and fitted values

 Syntax
 
     h = checkevent(T,Q,q,dqdt,r,alltags,eventtag)
 
 Description
  
     h = checkevent(T,Q,q,dqdt,r,alltags,eventtag) makes a four-panel plot of
     event identified by eventtag 
 
 Required inputs
 
  q        approximated Q, e.g. Fits.q
  dqdt     approximated dQ/dt, e.g. Fits.dqdt
  tags     event tag array, e.g. Fits.tag
  event    event tag (1:number of events, = max(tags))
  T        time array, 1:number of time steps (not reshaped version)
  Q        flow array, 1:number of time steps (not reshaped version)
 
 
 See also <a href="eventplotter.html" class="code" title="function [h,f] = eventplotter(T,Q,R,Info,varargin)">eventplotter</a>

 Matt Cooper, 04-Nov-2022, https://github.com/mgcooper</pre></div>


<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../html_img/up.png"></a></h2>

This function calls:
<ul style="list-style-image:url(../html_img/matlabicon.gif)">

<li><a href="prepfits.html" class="code" title="function [x,y,logx,logy,weights,success] = prepfits(q,dqdt,varargin)">prepfits</a>	PREPFITS preps q and -dq/dt for event-scale fitting</li></ul>


This function is called by:
<ul style="list-style-image:url(../html_img/matlabicon.gif)">
</ul>
<!-- crossreference -->


<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../html_img/up.png"></a></h2>
<ul style="list-style-image:url(../html_img/matlabicon.gif)">

<li><a href="#_sub1" class="code">function [eventT,eventQ,eventq,eventdq,</a></li>
<li><a href="#_sub2" class="code">function [tfit,qfit,dqfit,Qtstr,aQbstr,</a></li>
<li><a href="#_sub3" class="code">function [h,ax] = plotrain(time,rain)</a></li></ul>



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../html_img/up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function h = checkevent(T,Q,q,dqdt,r,alltags,eventtag,varargin)</a>
0002 <span class="comment">%CHECKEVENT plot detected recession event and fitted values</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% Syntax</span>
0005 <span class="comment">%</span>
0006 <span class="comment">%     h = checkevent(T,Q,q,dqdt,r,alltags,eventtag)</span>
0007 <span class="comment">%</span>
0008 <span class="comment">% Description</span>
0009 <span class="comment">%</span>
0010 <span class="comment">%     h = checkevent(T,Q,q,dqdt,r,alltags,eventtag) makes a four-panel plot of</span>
0011 <span class="comment">%     event identified by eventtag</span>
0012 <span class="comment">%</span>
0013 <span class="comment">% Required inputs</span>
0014 <span class="comment">%</span>
0015 <span class="comment">%  q        approximated Q, e.g. Fits.q</span>
0016 <span class="comment">%  dqdt     approximated dQ/dt, e.g. Fits.dqdt</span>
0017 <span class="comment">%  tags     event tag array, e.g. Fits.tag</span>
0018 <span class="comment">%  event    event tag (1:number of events, = max(tags))</span>
0019 <span class="comment">%  T        time array, 1:number of time steps (not reshaped version)</span>
0020 <span class="comment">%  Q        flow array, 1:number of time steps (not reshaped version)</span>
0021 <span class="comment">%</span>
0022 <span class="comment">%</span>
0023 <span class="comment">% See also eventplotter</span>
0024 <span class="comment">%</span>
0025 <span class="comment">% Matt Cooper, 04-Nov-2022, https://github.com/mgcooper</span>
0026 
0027 <span class="comment">% if called with no input, open this file</span>
0028 <span class="keyword">if</span> nargin == 0; open(mfilename(<span class="string">'fullpath'</span>)); <span class="keyword">return</span>; <span class="keyword">end</span>
0029 
0030 <span class="comment">% I think T,Q should be from Events, and q/dqdt/alltags/eventtag from Fits</span>
0031 
0032 <span class="comment">% NOTE: two fits are shown in the legend b/c the first one is from the provided</span>
0033 <span class="comment">% inputs and the second one is computed in this function as a check on the input</span>
0034 
0035 <span class="comment">% --------------- parse inputs</span>
0036 p = bfra.deps.magicParser;
0037 p.FunctionName = <span class="string">'bfra.checkevent'</span>;
0038 
0039 p.addRequired(<span class="string">'T'</span>,               @(x)isnumeric(x) | isdatetime(x));
0040 p.addRequired(<span class="string">'Q'</span>,               @(x)isnumeric(x));
0041 p.addRequired(<span class="string">'q'</span>,               @(x)isnumeric(x));
0042 p.addRequired(<span class="string">'dqdt'</span>,            @(x)isnumeric(x));
0043 p.addRequired(<span class="string">'r'</span>,               @(x)isnumeric(x));
0044 p.addRequired(<span class="string">'alltags'</span>,         @(x)isnumeric(x));
0045 p.addRequired(<span class="string">'eventtag'</span>,        @(x)isnumeric(x));
0046 p.addParameter(<span class="string">'order'</span>,    nan,  @(x)isnumeric(x));
0047 p.addParameter(<span class="string">'ax'</span>,       gca,  @(x)bfra.validation.isaxis(x));
0048 
0049 p.parseMagically(<span class="string">'caller'</span>);
0050 
0051 order = p.Results.order;
0052 
0053 <span class="keyword">if</span> isdatetime(T)
0054    T = datenum(T);
0055 <span class="keyword">end</span>
0056 
0057 <span class="comment">% --------------- function code</span>
0058 import bfra.util.subtight
0059 warning off
0060 colors = get(0,<span class="string">'defaultaxescolororder'</span>);
0061 colors = colors([1 2 5 4 3 6 7],:); <span class="comment">% swap yellow and green</span>
0062 
0063 <span class="comment">% this allows a column vector of tags instead of a reshaped matrix</span>
0064 rowcol = true;
0065 <span class="keyword">if</span> all(size(Q) == size(T)) &amp;&amp; all(size(Q) == size(alltags))
0066    rowcol = false;
0067 <span class="keyword">end</span>
0068 
0069 <span class="keyword">if</span> isnan(order); fixb = false; <span class="keyword">else</span>, fixb = true; <span class="keyword">end</span>
0070 
0071 
0072 <span class="comment">% --------------- prep for fitting</span>
0073 
0074 [  eventT,eventQ,                                                       <span class="keyword">...</span>
0075    eventq,eventdqdt,                                                    <span class="keyword">...</span>
0076    eventr,annualT,                                                      <span class="keyword">...</span>
0077    annualQ,annualr   ]  =  prepinput(rowcol,alltags,eventtag,T,Q,q,dqdt,r);
0078 
0079 
0080 [  tfit,qfit,dqfit,                                                     <span class="keyword">...</span>
0081    Qtstr,aQbstr,                                                        <span class="keyword">...</span>
0082    qfit0,dqfit0,                                                        <span class="keyword">...</span>
0083    Qtstr0,aQbstr0,                                                      <span class="keyword">...</span>
0084    rsq0              ]  =  <a href="prepfits.html" class="code" title="function [x,y,logx,logy,weights,success] = prepfits(q,dqdt,varargin)">prepfits</a>(eventq,eventdqdt,eventT,fixb,order);
0085 
0086 
0087 <span class="comment">% --------------- make the figure</span>
0088 
0089 h.f = figure(<span class="string">'Position'</span>,[150 80 800 550]);
0090 <span class="comment">% h.f = gcf;</span>
0091 
0092 <span class="comment">% plot the entire year and the event  (panel 1)</span>
0093 <span class="comment">%h.t1  = tiledlayout(3,2,'TileSpacing','none','Padding','none');</span>
0094 <span class="comment">%nexttile([1 2]);</span>
0095 
0096 <span class="comment">% use subplot instead</span>
0097 h.t1 = subtight(3,2,[1 2],<span class="string">'style'</span>,<span class="string">'fitted'</span>);
0098 
0099 h.h1a = plot(annualT,annualQ, <span class="string">'-o'</span>,<span class="string">'Color'</span>,colors(1,:) ); hold on;
0100 h.h1b = plot(eventT,eventQ,   <span class="string">'-o'</span>,<span class="string">'Color'</span>,colors(2,:) );
0101 <span class="comment">% h.h1c = plot(eventT,eventq,   '-o','Color',col(3,:) );</span>
0102 
0103 ylabel(<span class="string">'$Q$ [m$^3$ d$^{-1}$]'</span>); datetick(h.t1,<span class="string">'keepticks'</span>);
0104 
0105 <span class="comment">% these are temporary, new settings to get it to look right</span>
0106 box off; grid off
0107 set(gca,<span class="string">'TickLength'</span>,[0.01 0.1],<span class="string">'YScale'</span>,<span class="string">'log'</span>,<span class="string">'TickLabelInterpreter'</span>,<span class="string">'latex'</span>)
0108 
0109 title([datestr(eventT(1)) <span class="string">' - '</span> datestr(eventT(end)) <span class="string">' (Event '</span> num2str(eventtag) <span class="string">')'</span>]);
0110 
0111 ax = gca;
0112 
0113 <span class="comment">% plot the rain as bars and add the legend</span>
0114 h.ax1a   = ax; clear ax
0115 [hb,ax]  = <a href="#_sub3" class="code" title="subfunction [h,ax] = plotrain(time,rain)">plotrain</a>(annualT,annualr); yyaxis left
0116 h.h1d    = hb;
0117 h.ax1b   = ax;
0118 h.leg1   = legend(<span class="string">'$Q$ (observed)'</span>,<span class="string">'$Q$ (event)'</span>,<span class="string">'rain'</span>,<span class="string">'Interpreter'</span>,<span class="string">'latex'</span>);
0119 <span class="comment">% h.leg1   = legend('$Q$ (observed)','$Q$ (event)','$Q$ (event fit)','rain');</span>
0120 
0121 <span class="comment">% --------------- next subplot</span>
0122 
0123 <span class="comment">% plot observed flow and fitted flow vs time (panel 2)</span>
0124 <span class="comment">%nexttile(3);</span>
0125 h.t2 = subtight(3,2,3,<span class="string">'style'</span>,<span class="string">'fitted'</span>);
0126 
0127 h.h2a = plot(eventT,eventq,<span class="string">'-o'</span>, <span class="string">'Color'</span>, colors(1,:) ); hold on;
0128 h.h2b = plot(tfit,qfit,  <span class="string">':'</span>,  <span class="string">'Color'</span>, colors(2,:),<span class="string">'LineWidth'</span>,3);
0129 
0130 ylabel(<span class="string">'$Q$ [m$^3$ d$^{-1}$]'</span>); datetick;
0131 
0132 set(gca,<span class="string">'TickLabelInterpreter'</span>,<span class="string">'latex'</span>)
0133 
0134 <span class="comment">% plot fixed-b solution and update legend</span>
0135 <span class="keyword">if</span> fixb == true
0136    h.h2c = plot(tfit,qfit0,<span class="string">':o'</span>,<span class="string">'Color'</span>,colors(2,:));
0137    ltxt  = {<span class="string">'$Q$ (ETS fit)'</span>,Qtstr,Qtstr0,<span class="string">'rain'</span>};
0138 <span class="keyword">else</span>
0139    ltxt  = {<span class="string">'$Q$ (ETS fit)'</span>,Qtstr,<span class="string">'rain'</span>};
0140 <span class="keyword">end</span>
0141 
0142 <span class="comment">% plot the rain as bars and add the legend</span>
0143 h.ax2a   = gca;
0144 [hb,ax]  = <a href="#_sub3" class="code" title="subfunction [h,ax] = plotrain(time,rain)">plotrain</a>(eventT,eventr);
0145 h.h2c    = hb;
0146 h.ax2b   = ax;
0147 h.leg2   = legend(ltxt,<span class="string">'Location'</span>,<span class="string">'northeast'</span>,<span class="string">'Interpreter'</span>,<span class="string">'latex'</span>);
0148 
0149 grid off
0150 
0151 <span class="comment">% --------------- next subplot</span>
0152 
0153 <span class="comment">% plot observed dQdt and fitted dQdt vs Q  (panel 3)</span>
0154 <span class="comment">% nexttile(5);</span>
0155 h.t3  = subtight(3,2,5,<span class="string">'style'</span>,<span class="string">'fitted'</span>);
0156 
0157 h.h3a = plot(eventT,-eventdqdt,<span class="string">'-o'</span>, <span class="string">'Color'</span>,colors(1,:)); hold on;
0158 h.h3b = plot(tfit,-dqfit,    <span class="string">':'</span>,  <span class="string">'Color'</span>,colors(2,:),<span class="string">'LineWidth'</span>,3);
0159 
0160 ylabel(<span class="string">'-d$Q$/d$t$ [m$^3$ d$^{-1}$ d$^{-1}$]'</span>); datetick;
0161 set(gca,<span class="string">'TickLabelInterpreter'</span>,<span class="string">'latex'</span>)
0162 
0163 <span class="comment">% plot fixed-b solution and update legend</span>
0164 <span class="keyword">if</span> fixb == true
0165    h.h3c = plot(tfit,-dqfit0,<span class="string">':o'</span>,<span class="string">'Color'</span>,colors(2,:));
0166    ltxt  = {<span class="string">'-d$Q$/d$t$ (ETS fit)'</span>,aQbstr,aQbstr0};
0167 <span class="keyword">else</span>
0168    ltxt  = {<span class="string">'-d$Q$/d$t$ (ETS fit)'</span>,aQbstr};
0169 <span class="keyword">end</span>
0170 
0171 h.leg3   = legend(ltxt,<span class="string">'Interpreter'</span>,<span class="string">'latex'</span>,<span class="string">'location'</span>,<span class="string">'northeast'</span>);
0172 h.ax3    = gca;
0173 
0174 grid off
0175 
0176 <span class="comment">% --------------- next subplot</span>
0177 <span class="comment">% bfra_dQdt plot</span>
0178 
0179 <span class="comment">%h.t4 = nexttile([2 1]);</span>
0180 h.t4 = subtight(3,2,[4 6],<span class="string">'style'</span>,<span class="string">'fitted'</span>);
0181 
0182 <span class="keyword">if</span> all(isnan(eventq))
0183    <span class="keyword">return</span>   
0184 <span class="keyword">else</span>
0185    h2 = bfra.pointcloudplot(eventq,eventdqdt,<span class="string">'ax'</span>,h.t4,<span class="string">'reflines'</span>, <span class="keyword">...</span>
0186       {<span class="string">'lowerenvelope'</span>,<span class="string">'upperenvelope'</span>,<span class="string">'early'</span>,<span class="string">'late'</span>,<span class="string">'bestfit'</span>}, <span class="keyword">...</span>
0187       <span class="string">'reflabels'</span>,false,<span class="string">'rain'</span>,eventr,<span class="string">'addlegend'</span>,true);
0188    <span class="comment">% h2  = bfra_plotdQdt(eventq,eventdqdt,'ax',ax,'rain',eventr); hold on;</span>
0189    
0190    h.pcloud = h2;
0191    h.ax4    = gca;
0192    h.h4a    = h2.scatter;
0193    h.h4b    = h2.reflines; <span class="comment">% h.h4b = h2.plots{:}; % if using bfra_plotdQdt</span>
0194    
0195    
0196    <span class="keyword">if</span> fixb
0197       plot(qfit0,-dqfit0,<span class="string">'--'</span>);
0198       ltxt = [aQbstr0 <span class="string">' (r2 = '</span> printf(rsq0,2) <span class="string">')'</span>];
0199       h2.legend.String{end} = ltxt;
0200    <span class="keyword">end</span>
0201    
0202    <span class="comment">% settins</span>
0203    
0204    set(h.h1a,<span class="string">'MarkerFaceColor'</span>,colors(1,:),<span class="string">'MarkerEdgeColor'</span>,<span class="string">'none'</span>);
0205    set(h.h1b,<span class="string">'MarkerFaceColor'</span>,colors(2,:),<span class="string">'MarkerEdgeColor'</span>,<span class="string">'none'</span>);
0206    <span class="comment">% set(h.h1c,'MarkerFaceColor',col(3,:),'MarkerEdgeColor','none');</span>
0207    set(h.h2a,<span class="string">'MarkerFaceColor'</span>,colors(1,:),<span class="string">'MarkerEdgeColor'</span>,<span class="string">'none'</span>);
0208    set(h.h3a,<span class="string">'MarkerFaceColor'</span>,colors(1,:),<span class="string">'MarkerEdgeColor'</span>,<span class="string">'none'</span>);
0209    
0210    <span class="comment">% --------------- see all events for this year</span>
0211    <span class="comment">%bfra_plotevents(Tt,Qq,min(Qq)/200,6,1,'neg');</span>
0212    
0213    <span class="comment">%    h.ax2a.XLim = h.ax1a.XLim;</span>
0214    
0215    <span class="comment">% instead send the annual flow back to main and do it there</span>
0216    h.T     = annualT;
0217    h.Q     = annualQ;
0218    
0219 <span class="keyword">end</span>
0220 
0221 
0222 <span class="comment">% --------------- prep input</span>
0223 
0224 <a name="_sub1" href="#_subfunctions" class="code">function [eventT,eventQ,eventq,eventdq, </a><span class="keyword">...</span>
0225    eventr,annualT,annualQ,annualr] = prepinput(userc,tags,event,T,Q,q,dqdt,rain)
0226 
0227 <span class="keyword">if</span> userc == true
0228    [r,c] = find(tags==event);
0229 <span class="keyword">else</span>
0230    r  = find(tags==event);
0231    c  = 1;
0232 <span class="keyword">end</span>
0233 
0234 <span class="comment">% if</span>
0235 
0236 eventT   = T(r);
0237 eventQ   = Q(r,c(1));
0238 eventq   = q(r,c(1));
0239 
0240 eventdq  = dqdt(r,c(1));
0241 eventr   = rain(r,c(1));
0242 
0243 <span class="comment">% pull out the time/flow for the entire year</span>
0244 <span class="keyword">if</span> isdatetime(T); T = datenum(T); <span class="keyword">end</span>
0245 
0246 dates    = datevec(eventT);
0247 eventyr  = dates(1,1);
0248 dates    = datevec(T);
0249 idx      = dates(:,1)==eventyr;
0250 annualT  = T(idx);
0251 annualQ  = Q(idx,c(1));
0252 annualr  = rain(idx,c(1));
0253 
0254 
0255 <span class="comment">% --------------- prep fits</span>
0256 
0257 <a name="_sub2" href="#_subfunctions" class="code">function [tfit,qfit,dqfit,Qtstr,aQbstr, </a><span class="keyword">...</span>
0258    qfit0,dqfit0,Qtstr0,aQbstr0,rsq0] = <a href="prepfits.html" class="code" title="function [x,y,logx,logy,weights,success] = prepfits(q,dqdt,varargin)">prepfits</a>(eventq,eventdqdt,eventT,fixb,order);
0259 
0260 <span class="comment">% fit ab using nonlin</span>
0261 <span class="keyword">if</span> all(isnan(eventq))
0262    qfit=nan;dqfit=nan;Qtstr=<span class="string">'nan'</span>;aQbstr=<span class="string">'nan'</span>;ab=nan;qfit0=nan;
0263    dqfit0=nan;Qtstr0=<span class="string">'nan'</span>;aQbstr0=<span class="string">'nan'</span>;rsq0=nan;
0264    <span class="keyword">return</span>
0265 <span class="keyword">end</span>
0266 Fit   = bfra.fitab(eventq,eventdqdt,<span class="string">'nls'</span>);
0267 ab    = Fit.ab;
0268 Q0    = eventq(find(~isnan(eventq),1,<span class="string">'first'</span>));
0269 tfit  = eventT(~isnan(eventq));
0270 
0271 <span class="comment">% predicted Q from non-lin free</span>
0272 [qfit,dqfit]   = bfra.Qnonlin(ab(1),ab(2),Q0,tfit-tfit(1));
0273 [Qtstr,aQbstr] = bfra.QtauString(ab,<span class="string">'printvalues'</span>,true);
0274 
0275 <span class="comment">% if requested, fit with a fixed b value and get predicted Q and dQ/dt</span>
0276 <span class="keyword">if</span> fixb == true
0277    Fit            = bfra.fitab(eventq,eventdqdt,<span class="string">'mean'</span>,<span class="string">'order'</span>,order);
0278    ab0            = Fit.ab;
0279    rsq0           = Fit.rsq;
0280    [qfit0,dqfit0] = bfra.Qnonlin(ab0(1),ab0(2),Q0,tfit-tfit(1));
0281    [Qtstr0,aQbstr0]  = bfra.QtauString(ab0,<span class="string">'printvalues'</span>,true);
0282 <span class="keyword">else</span>
0283    ab0      = nan;
0284    rsq0     = nan;
0285    qfit0    = nan;
0286    dqfit0   = nan;
0287    Qtstr0   = nan;
0288    aQbstr0  = nan;
0289 <span class="keyword">end</span>
0290 
0291 <span class="comment">% --------------- plot rain</span>
0292 
0293 <a name="_sub3" href="#_subfunctions" class="code">function [h,ax] = plotrain(time,rain)</a>
0294 
0295 rcolor = [0.85 0.325 0.098];
0296 
0297 ax = gca; yyaxis right
0298 h = bar(time,rain,0.2,  <span class="string">'FaceColor'</span>,   rcolor,           <span class="keyword">...</span>
0299                         <span class="string">'FaceAlpha'</span>,   0.5,              <span class="keyword">...</span>
0300                         <span class="string">'EdgeColor'</span>,   <span class="string">'none'</span>            );
0301 
0302 ylabel(<span class="string">'rain (mm d$^{-1}$)'</span>,<span class="string">'Color'</span>,rcolor);
0303 set(gca,<span class="string">'YColor'</span>,<span class="string">'k'</span>)
0304 datetick; axis tight; axis(ax,<span class="string">'ij'</span>);
0305 
0306 
0307 <span class="comment">% --------------- extra stuff</span>
0308 <span class="comment">% If I want to add back the log</span>
0309 <span class="comment">%     yyaxis right</span>
0310 <span class="comment">%     pause(0.001)</span>
0311 <span class="comment">%     semilogy(t,q,'-o'); hold on; semilogy(t,qfit,':');</span>
0312 <span class="comment">%     set(gca,'YScale','log')</span>
0313 
0314 <span class="comment">%     yyaxis right</span>
0315 <span class="comment">%     semilogy(t,-dqdt,'-o'); hold on; semilogy(t,dqfit,':'); datetick;</span>
0316 <span class="comment">%     ylabel('-dQ/dt')</span>
0317 
0318 
0319 <span class="comment">%     % for debugging</span>
0320 <span class="comment">%     f       = @(a,b,Q0,x) (Q0^(1-b)-(1-b).*a.*x).^(1/(1-b));</span>
0321 <span class="comment">%     qtst    = f(ab(1),ab(2),q(1),t-t(1)+1);</span>
0322 <span class="comment">%     dqtst   = ab(1).*qtst.^ab(2);</span>
0323 <span class="comment">%</span>
0324 <span class="comment">%     figure; plot(t,q,'-o'); legend('obs'); datetick; hold on;</span>
0325 <span class="comment">%     figure; plot(t,qfit,'-o'); legend('fit function'); datetick</span>
0326 <span class="comment">%     figure; plot(t,qtst,'-o'); legend('fit test'); datetick</span>
0327 <span class="comment">%</span>
0328 <span class="comment">%     figure; plot(q,-dqdt,'-o');legend('obs');</span>
0329 <span class="comment">%     figure; plot(qfit,dqfit,'-o'); legend('fit function');</span>
0330 <span class="comment">%     figure; plot(q,-dqtst,'-o'); legend('fit test');</span>
0331 
0332 <span class="comment">%abl         = bfra_quickfit(q,dqdt,'lin');</span>
0333 <span class="comment">%[q,dqdt]    = bfra_Qlin(a,b,Q0,t)</span></pre></div>
</body>
</html>