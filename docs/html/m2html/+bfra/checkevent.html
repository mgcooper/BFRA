<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of checkevent</title>
  <meta name="keywords" content="checkevent">
  <meta name="description" content="CHECKEVENT plot detected recession event and fitted values">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../function_index.html">Home</a> &gt;  <a href="function_index.html">+bfra</a> &gt; checkevent.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../function_index.html"><img alt="<" border="0" src="../html_img/left.png">&nbsp;Master index</a></td>
<td align="right"><a href="function_index.html">Index for +bfra&nbsp;<img alt=">" border="0" src="../html_img/right.png"></a></td></tr></table>-->

<h1>checkevent
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../html_img/up.png"></a></h2>
<div class="box"><strong>CHECKEVENT plot detected recession event and fitted values</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../html_img/up.png"></a></h2>
<div class="box"><strong>function h = checkevent(T,Q,q,dqdt,r,alltags,eventtag,varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../html_img/up.png"></a></h2>
<div class="fragment"><pre class="comment">CHECKEVENT plot detected recession event and fitted values

 Syntax
 
     h = checkevent(T,Q,q,dqdt,r,alltags,eventtag)
 
 Description
  
     h = checkevent(T,Q,q,dqdt,r,alltags,eventtag) makes a four-panel plot of
     event identified by eventtag 
 
 Required inputs
 
  q        approximated Q, e.g. Fits.q
  dqdt     approximated dQ/dt, e.g. Fits.dqdt
  tags     event tag array, e.g. Fits.tag
  event    event tag (1:number of events, = max(tags))
  T        time array, 1:number of time steps (not reshaped version)
  Q        flow array, 1:number of time steps (not reshaped version)
 
 
 See also <a href="eventplotter.html" class="code" title="function [h,f] = eventplotter(T,Q,R,Info,varargin)">eventplotter</a>

 Matt Cooper, 04-Nov-2022, https://github.com/mgcooper</pre></div>


<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../html_img/up.png"></a></h2>

This function calls:
<ul style="list-style-image:url(../html_img/matlabicon.gif)">

<li><a href="prepfits.html" class="code" title="function [x,y,logx,logy,w,ok] = prepfits(q,dqdt,varargin)">prepfits</a>	PREPFITS preps q and -dq/dt for event-scale fitting</li></ul>


This function is called by:
<ul style="list-style-image:url(../html_img/matlabicon.gif)">
</ul>
<!-- crossreference -->


<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../html_img/up.png"></a></h2>
<ul style="list-style-image:url(../html_img/matlabicon.gif)">

<li><a href="#_sub1" class="code">function [eventT, eventQ, eventq, eventdq, eventr, annualT, annualQ, annualr] =</a></li>
<li><a href="#_sub2" class="code">function [tfit, qfit, dqfit, Qtstr, aQbstr, qfit0, dqfit0, Qtstr0,</a></li>
<li><a href="#_sub3" class="code">function [h,ax] = plotrain(time,rain)</a></li>
<li><a href="#_sub4" class="code">function [T, Q, q, dqdt, r, alltags, eventtag, order] = parseinputs(</a></li></ul>



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../html_img/up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function h = checkevent(T,Q,q,dqdt,r,alltags,eventtag,varargin)</a>
0002 <span class="comment">%CHECKEVENT plot detected recession event and fitted values</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% Syntax</span>
0005 <span class="comment">%</span>
0006 <span class="comment">%     h = checkevent(T,Q,q,dqdt,r,alltags,eventtag)</span>
0007 <span class="comment">%</span>
0008 <span class="comment">% Description</span>
0009 <span class="comment">%</span>
0010 <span class="comment">%     h = checkevent(T,Q,q,dqdt,r,alltags,eventtag) makes a four-panel plot of</span>
0011 <span class="comment">%     event identified by eventtag</span>
0012 <span class="comment">%</span>
0013 <span class="comment">% Required inputs</span>
0014 <span class="comment">%</span>
0015 <span class="comment">%  q        approximated Q, e.g. Fits.q</span>
0016 <span class="comment">%  dqdt     approximated dQ/dt, e.g. Fits.dqdt</span>
0017 <span class="comment">%  tags     event tag array, e.g. Fits.tag</span>
0018 <span class="comment">%  event    event tag (1:number of events, = max(tags))</span>
0019 <span class="comment">%  T        time array, 1:number of time steps (not reshaped version)</span>
0020 <span class="comment">%  Q        flow array, 1:number of time steps (not reshaped version)</span>
0021 <span class="comment">%</span>
0022 <span class="comment">%</span>
0023 <span class="comment">% See also eventplotter</span>
0024 <span class="comment">%</span>
0025 <span class="comment">% Matt Cooper, 04-Nov-2022, https://github.com/mgcooper</span>
0026 
0027 <span class="comment">% if called with no input, open this file</span>
0028 <span class="keyword">if</span> nargin == 0; open(mfilename(<span class="string">'fullpath'</span>)); <span class="keyword">return</span>; <span class="keyword">end</span>
0029 
0030 <span class="comment">% I think T,Q should be from Events, and q/dqdt/alltags/eventtag from Fits</span>
0031 
0032 <span class="comment">% NOTE: two fits are shown in the legend b/c the first one is from the provided</span>
0033 <span class="comment">% inputs and the second one is computed in this function as a check on the input</span>
0034 
0035 <span class="comment">% PARSE INPUTS</span>
0036 [T, Q, q, dqdt, r, alltags, eventtag, order] = <a href="#_sub4" class="code" title="subfunction [T, Q, q, dqdt, r, alltags, eventtag, order] = parseinputs( ">parseinputs</a>( <span class="keyword">...</span>
0037    T, Q, q, dqdt, r, alltags, eventtag, varargin{:});
0038 
0039 <span class="comment">% FUNCTION CODE</span>
0040 
0041 <span class="comment">% warning off % commented out for octave, need to get the msgid</span>
0042 colors = get(0,<span class="string">'defaultaxescolororder'</span>);
0043 colors = colors([1 2 5 4 3 6 7],:); <span class="comment">% swap yellow and green</span>
0044 
0045 <span class="comment">% this allows a column vector of tags instead of a reshaped matrix</span>
0046 rowcol = true;
0047 <span class="keyword">if</span> all(size(Q) == size(T)) &amp;&amp; all(size(Q) == size(alltags))
0048    rowcol = false;
0049 <span class="keyword">end</span>
0050 
0051 <span class="keyword">if</span> isnan(order); fixb = false; <span class="keyword">else</span>, fixb = true; <span class="keyword">end</span>
0052 
0053 
0054 <span class="comment">% --------------- prep for fitting</span>
0055 
0056 [  eventT,eventQ,                                                       <span class="keyword">...</span>
0057    eventq,eventdqdt,                                                    <span class="keyword">...</span>
0058    eventr,annualT,                                                      <span class="keyword">...</span>
0059    annualQ,annualr   ]  =  prepinput(rowcol,alltags,eventtag,T,Q,q,dqdt,r);
0060 
0061 
0062 [  tfit,qfit,dqfit,                                                     <span class="keyword">...</span>
0063    Qtstr,aQbstr,                                                        <span class="keyword">...</span>
0064    qfit0,dqfit0,                                                        <span class="keyword">...</span>
0065    Qtstr0,aQbstr0,                                                      <span class="keyword">...</span>
0066    rsq0              ]  =  <a href="prepfits.html" class="code" title="function [x,y,logx,logy,w,ok] = prepfits(q,dqdt,varargin)">prepfits</a>(eventq,eventdqdt,eventT,fixb,order);
0067 
0068 
0069 <span class="comment">% --------------- make the figure</span>
0070 
0071 h.f = figure(<span class="string">'Position'</span>,[150 80 800 550]);
0072 <span class="comment">% h.f = gcf;</span>
0073 
0074 <span class="comment">% plot the entire year and the event  (panel 1)</span>
0075 <span class="comment">%h.t1  = tiledlayout(3,2,'TileSpacing','none','Padding','none');</span>
0076 <span class="comment">%nexttile([1 2]);</span>
0077 
0078 <span class="comment">% use subplot instead of tiledlayout</span>
0079 h.t1 = bfra.util.subtight(3,2,[1 2],<span class="string">'style'</span>,<span class="string">'fitted'</span>);
0080 
0081 h.h1a = plot(annualT,annualQ, <span class="string">'-o'</span>,<span class="string">'Color'</span>,colors(1,:) ); hold on;
0082 h.h1b = plot(eventT,eventQ,   <span class="string">'-o'</span>,<span class="string">'Color'</span>,colors(2,:) );
0083 <span class="comment">% h.h1c = plot(eventT,eventq,   '-o','Color',col(3,:) );</span>
0084 
0085 ylabel(<span class="string">'$Q$ [m$^3$ d$^{-1}$]'</span>); datetick(h.t1,<span class="string">'keepticks'</span>);
0086 
0087 <span class="comment">% these are temporary, new settings to get it to look right</span>
0088 box off; grid off
0089 set(gca,<span class="string">'TickLength'</span>,[0.01 0.1],<span class="string">'YScale'</span>,<span class="string">'log'</span>,<span class="string">'TickLabelInterpreter'</span>,<span class="string">'latex'</span>)
0090 
0091 title([datestr(eventT(1)) <span class="string">' - '</span> datestr(eventT(end)) <span class="string">' (Event '</span> num2str(eventtag) <span class="string">')'</span>]);
0092 
0093 ax = gca;
0094 
0095 <span class="comment">% plot the rain as bars and add the legend</span>
0096 h.ax1a   = ax; clear ax
0097 [hb,ax]  = <a href="#_sub3" class="code" title="subfunction [h,ax] = plotrain(time,rain)">plotrain</a>(annualT,annualr); yyaxis left
0098 h.h1d    = hb;
0099 h.ax1b   = ax;
0100 h.leg1   = legend(<span class="string">'$Q$ (observed)'</span>,<span class="string">'$Q$ (event)'</span>,<span class="string">'rain'</span>,<span class="string">'Interpreter'</span>,<span class="string">'latex'</span>);
0101 <span class="comment">% h.leg1   = legend('$Q$ (observed)','$Q$ (event)','$Q$ (event fit)','rain');</span>
0102 
0103 <span class="comment">% --------------- next subplot</span>
0104 
0105 <span class="comment">% plot observed flow and fitted flow vs time (panel 2)</span>
0106 <span class="comment">%nexttile(3);</span>
0107 h.t2 = bfra.util.subtight(3,2,3,<span class="string">'style'</span>,<span class="string">'fitted'</span>);
0108 
0109 h.h2a = plot(eventT,eventq,<span class="string">'-o'</span>, <span class="string">'Color'</span>, colors(1,:) ); hold on;
0110 h.h2b = plot(tfit,qfit,  <span class="string">':'</span>,  <span class="string">'Color'</span>, colors(2,:),<span class="string">'LineWidth'</span>,3);
0111 
0112 ylabel(<span class="string">'$Q$ [m$^3$ d$^{-1}$]'</span>); datetick;
0113 
0114 set(gca,<span class="string">'TickLabelInterpreter'</span>,<span class="string">'latex'</span>)
0115 
0116 <span class="comment">% plot fixed-b solution and update legend</span>
0117 <span class="keyword">if</span> fixb == true
0118    h.h2c = plot(tfit,qfit0,<span class="string">':o'</span>,<span class="string">'Color'</span>,colors(2,:));
0119    ltxt  = {<span class="string">'$Q$ (ETS fit)'</span>,Qtstr,Qtstr0,<span class="string">'rain'</span>};
0120 <span class="keyword">else</span>
0121    ltxt  = {<span class="string">'$Q$ (ETS fit)'</span>,Qtstr,<span class="string">'rain'</span>};
0122 <span class="keyword">end</span>
0123 
0124 <span class="comment">% plot the rain as bars and add the legend</span>
0125 h.ax2a   = gca;
0126 [hb,ax]  = <a href="#_sub3" class="code" title="subfunction [h,ax] = plotrain(time,rain)">plotrain</a>(eventT,eventr);
0127 h.h2c    = hb;
0128 h.ax2b   = ax;
0129 h.leg2   = legend(ltxt,<span class="string">'Location'</span>,<span class="string">'northeast'</span>,<span class="string">'Interpreter'</span>,<span class="string">'latex'</span>);
0130 
0131 grid off
0132 
0133 <span class="comment">% --------------- next subplot</span>
0134 
0135 <span class="comment">% plot observed dQdt and fitted dQdt vs Q  (panel 3)</span>
0136 <span class="comment">% nexttile(5);</span>
0137 h.t3  = bfra.util.subtight(3,2,5,<span class="string">'style'</span>,<span class="string">'fitted'</span>);
0138 
0139 h.h3a = plot(eventT,-eventdqdt,<span class="string">'-o'</span>, <span class="string">'Color'</span>,colors(1,:)); hold on;
0140 h.h3b = plot(tfit,-dqfit,    <span class="string">':'</span>,  <span class="string">'Color'</span>,colors(2,:),<span class="string">'LineWidth'</span>,3);
0141 
0142 ylabel(<span class="string">'-d$Q$/d$t$ [m$^3$ d$^{-1}$ d$^{-1}$]'</span>); datetick;
0143 set(gca,<span class="string">'TickLabelInterpreter'</span>,<span class="string">'latex'</span>)
0144 
0145 <span class="comment">% plot fixed-b solution and update legend</span>
0146 <span class="keyword">if</span> fixb == true
0147    h.h3c = plot(tfit,-dqfit0,<span class="string">':o'</span>,<span class="string">'Color'</span>,colors(2,:));
0148    ltxt  = {<span class="string">'-d$Q$/d$t$ (ETS fit)'</span>,aQbstr,aQbstr0};
0149 <span class="keyword">else</span>
0150    ltxt  = {<span class="string">'-d$Q$/d$t$ (ETS fit)'</span>,aQbstr};
0151 <span class="keyword">end</span>
0152 
0153 h.leg3   = legend(ltxt,<span class="string">'Interpreter'</span>,<span class="string">'latex'</span>,<span class="string">'location'</span>,<span class="string">'northeast'</span>);
0154 h.ax3    = gca;
0155 
0156 grid off
0157 
0158 <span class="comment">% --------------- next subplot</span>
0159 <span class="comment">% bfra_dQdt plot</span>
0160 
0161 <span class="comment">%h.t4 = nexttile([2 1]);</span>
0162 h.t4 = bfra.util.subtight(3,2,[4 6],<span class="string">'style'</span>,<span class="string">'fitted'</span>);
0163 
0164 <span class="keyword">if</span> all(isnan(eventq))
0165    <span class="keyword">return</span>   
0166 <span class="keyword">else</span>
0167    h2 = bfra.pointcloudplot(eventq,eventdqdt,<span class="string">'ax'</span>,h.t4,<span class="string">'reflines'</span>, <span class="keyword">...</span>
0168       {<span class="string">'lowerenvelope'</span>,<span class="string">'upperenvelope'</span>,<span class="string">'early'</span>,<span class="string">'late'</span>,<span class="string">'bestfit'</span>}, <span class="keyword">...</span>
0169       <span class="string">'reflabels'</span>,false,<span class="string">'rain'</span>,eventr,<span class="string">'addlegend'</span>,true);
0170    <span class="comment">% h2  = bfra_plotdQdt(eventq,eventdqdt,'ax',ax,'rain',eventr); hold on;</span>
0171    
0172    h.pcloud = h2;
0173    h.ax4    = gca;
0174    h.h4a    = h2.scatter;
0175    h.h4b    = h2.reflines; <span class="comment">% h.h4b = h2.plots{:}; % if using bfra_plotdQdt</span>
0176    
0177    
0178    <span class="keyword">if</span> fixb
0179       plot(qfit0,-dqfit0,<span class="string">'--'</span>);
0180       ltxt = [aQbstr0 <span class="string">' (r2 = '</span> bfra.util.printnum(rsq0,2) <span class="string">')'</span>];
0181       h2.legend.String{end} = ltxt;
0182    <span class="keyword">end</span>
0183    
0184    <span class="comment">% settins</span>
0185    
0186    set(h.h1a,<span class="string">'MarkerFaceColor'</span>,colors(1,:),<span class="string">'MarkerEdgeColor'</span>,<span class="string">'none'</span>);
0187    set(h.h1b,<span class="string">'MarkerFaceColor'</span>,colors(2,:),<span class="string">'MarkerEdgeColor'</span>,<span class="string">'none'</span>);
0188    <span class="comment">% set(h.h1c,'MarkerFaceColor',col(3,:),'MarkerEdgeColor','none');</span>
0189    set(h.h2a,<span class="string">'MarkerFaceColor'</span>,colors(1,:),<span class="string">'MarkerEdgeColor'</span>,<span class="string">'none'</span>);
0190    set(h.h3a,<span class="string">'MarkerFaceColor'</span>,colors(1,:),<span class="string">'MarkerEdgeColor'</span>,<span class="string">'none'</span>);
0191    
0192    <span class="comment">% --------------- see all events for this year</span>
0193    <span class="comment">%bfra_plotevents(Tt,Qq,min(Qq)/200,6,1,'neg');</span>
0194    
0195    <span class="comment">%    h.ax2a.XLim = h.ax1a.XLim;</span>
0196    
0197    <span class="comment">% instead send the annual flow back to main and do it there</span>
0198    h.T     = annualT;
0199    h.Q     = annualQ;
0200    
0201 <span class="keyword">end</span>
0202 
0203 
0204 <span class="comment">% --------------- prep input</span>
0205 
0206 <a name="_sub1" href="#_subfunctions" class="code">function [eventT, eventQ, eventq, eventdq, eventr, annualT, annualQ, annualr] = </a><span class="keyword">...</span>
0207    prepinput(userc,tags,event,T,Q,q,dqdt,rain)
0208 
0209 <span class="keyword">if</span> userc == true
0210    [r,c] = find(tags==event);
0211 <span class="keyword">else</span>
0212    r  = find(tags==event);
0213    c  = 1;
0214 <span class="keyword">end</span>
0215 
0216 <span class="comment">% if</span>
0217 
0218 eventT   = T(r);
0219 eventQ   = Q(r,c(1));
0220 eventq   = q(r,c(1));
0221 
0222 eventdq  = dqdt(r,c(1));
0223 eventr   = rain(r,c(1));
0224 
0225 <span class="comment">% pull out the time/flow for the entire year</span>
0226 <span class="keyword">if</span> isdatetime(T); T = datenum(T); <span class="keyword">end</span>
0227 
0228 dates    = datevec(eventT);
0229 eventyr  = dates(1,1);
0230 dates    = datevec(T);
0231 idx      = dates(:,1)==eventyr;
0232 annualT  = T(idx);
0233 annualQ  = Q(idx,c(1));
0234 annualr  = rain(idx,c(1));
0235 
0236 
0237 <span class="comment">% --------------- prep fits</span>
0238 
0239 <a name="_sub2" href="#_subfunctions" class="code">function [tfit, qfit, dqfit, Qtstr, aQbstr, qfit0, dqfit0, Qtstr0, </a><span class="keyword">...</span>
0240    aQbstr0, rsq0] = <a href="prepfits.html" class="code" title="function [x,y,logx,logy,w,ok] = prepfits(q,dqdt,varargin)">prepfits</a>(eventq, eventdqdt, eventT, fixb, order)
0241 
0242 <span class="comment">% fit ab using nonlin</span>
0243 <span class="keyword">if</span> all(isnan(eventq))
0244    qfit=nan;dqfit=nan;Qtstr=<span class="string">'nan'</span>;aQbstr=<span class="string">'nan'</span>;ab=nan;qfit0=nan;
0245    dqfit0=nan;Qtstr0=<span class="string">'nan'</span>;aQbstr0=<span class="string">'nan'</span>;rsq0=nan;
0246    <span class="keyword">return</span>
0247 <span class="keyword">end</span>
0248 Fit   = bfra.fitab(eventq,eventdqdt,<span class="string">'nls'</span>);
0249 ab    = Fit.ab;
0250 Q0    = eventq(find(~isnan(eventq),1,<span class="string">'first'</span>));
0251 tfit  = eventT(~isnan(eventq));
0252 
0253 <span class="comment">% predicted Q from non-lin free</span>
0254 [qfit,dqfit]   = bfra.Qnonlin(ab(1),ab(2),Q0,tfit-tfit(1));
0255 [Qtstr,aQbstr] = bfra.QtauString(ab,<span class="string">'printvalues'</span>,true);
0256 
0257 <span class="comment">% if requested, fit with a fixed b value and get predicted Q and dQ/dt</span>
0258 <span class="keyword">if</span> fixb == true
0259    Fit            = bfra.fitab(eventq,eventdqdt,<span class="string">'mean'</span>,<span class="string">'order'</span>,order);
0260    ab0            = Fit.ab;
0261    rsq0           = Fit.rsq;
0262    [qfit0,dqfit0] = bfra.Qnonlin(ab0(1),ab0(2),Q0,tfit-tfit(1));
0263    [Qtstr0,aQbstr0]  = bfra.QtauString(ab0,<span class="string">'printvalues'</span>,true);
0264 <span class="keyword">else</span>
0265    ab0      = nan;
0266    rsq0     = nan;
0267    qfit0    = nan;
0268    dqfit0   = nan;
0269    Qtstr0   = nan;
0270    aQbstr0  = nan;
0271 <span class="keyword">end</span>
0272 
0273 <span class="comment">% --------------- plot rain</span>
0274 
0275 <a name="_sub3" href="#_subfunctions" class="code">function [h,ax] = plotrain(time,rain)</a>
0276 
0277 rcolor = [0.85 0.325 0.098];
0278 
0279 ax = gca; yyaxis right
0280 h = bar(time,rain,0.2,  <span class="string">'FaceColor'</span>,   rcolor,           <span class="keyword">...</span>
0281                         <span class="string">'FaceAlpha'</span>,   0.5,              <span class="keyword">...</span>
0282                         <span class="string">'EdgeColor'</span>,   <span class="string">'none'</span>            );
0283 
0284 ylabel(<span class="string">'rain (mm d$^{-1}$)'</span>,<span class="string">'Color'</span>,rcolor);
0285 set(gca,<span class="string">'YColor'</span>,<span class="string">'k'</span>)
0286 datetick; axis tight; axis(ax,<span class="string">'ij'</span>);
0287 
0288 <span class="comment">%% INPUT PARSER</span>
0289 <a name="_sub4" href="#_subfunctions" class="code">function [T, Q, q, dqdt, r, alltags, eventtag, order] = parseinputs( </a><span class="keyword">...</span>
0290    T, Q, q, dqdt, r, alltags, eventtag, varargin)
0291 
0292 parser = inputParser;
0293 parser.FunctionName = <span class="string">'bfra.checkevent'</span>;
0294 
0295 parser.addRequired(<span class="string">'T'</span>, @(x) isnumeric(x) | isdatetime(x));
0296 parser.addRequired(<span class="string">'Q'</span>, @isnumeric);
0297 parser.addRequired(<span class="string">'q'</span>, @isnumeric);
0298 parser.addRequired(<span class="string">'dqdt'</span>, @isnumeric);
0299 parser.addRequired(<span class="string">'r'</span>, @isnumeric);
0300 parser.addRequired(<span class="string">'alltags'</span>, @isnumeric);
0301 parser.addRequired(<span class="string">'eventtag'</span>, @isnumeric);
0302 parser.addParameter(<span class="string">'order'</span>, nan, @isnumeric);
0303 parser.addParameter(<span class="string">'ax'</span>, gca, @bfra.validation.isaxis);
0304 
0305 parser.parse(T, Q, q, dqdt, r, alltags, eventtag, varargin{:});
0306 
0307 T = parser.Results.T;
0308 Q = parser.Results.Q;
0309 q = parser.Results.q;
0310 r = parser.Results.r;
0311 dqdt = parser.Results.dqdt;
0312 order = parser.Results.order;
0313 alltags = parser.Results.alltags;
0314 eventtag = parser.Results.eventtag;
0315 
0316 <span class="keyword">if</span> isdatetime(T)
0317    T = datenum(T); <span class="comment">%#ok&lt;*DATNM&gt;</span>
0318 <span class="keyword">end</span>
0319 
0320 
0321 
0322 <span class="comment">% --------------- extra stuff</span>
0323 <span class="comment">% If I want to add back the log</span>
0324 <span class="comment">%     yyaxis right</span>
0325 <span class="comment">%     pause(0.001)</span>
0326 <span class="comment">%     semilogy(t,q,'-o'); hold on; semilogy(t,qfit,':');</span>
0327 <span class="comment">%     set(gca,'YScale','log')</span>
0328 
0329 <span class="comment">%     yyaxis right</span>
0330 <span class="comment">%     semilogy(t,-dqdt,'-o'); hold on; semilogy(t,dqfit,':'); datetick;</span>
0331 <span class="comment">%     ylabel('-dQ/dt')</span>
0332 
0333 
0334 <span class="comment">%     % for debugging</span>
0335 <span class="comment">%     f       = @(a,b,Q0,x) (Q0^(1-b)-(1-b).*a.*x).^(1/(1-b));</span>
0336 <span class="comment">%     qtst    = f(ab(1),ab(2),q(1),t-t(1)+1);</span>
0337 <span class="comment">%     dqtst   = ab(1).*qtst.^ab(2);</span>
0338 <span class="comment">%</span>
0339 <span class="comment">%     figure; plot(t,q,'-o'); legend('obs'); datetick; hold on;</span>
0340 <span class="comment">%     figure; plot(t,qfit,'-o'); legend('fit function'); datetick</span>
0341 <span class="comment">%     figure; plot(t,qtst,'-o'); legend('fit test'); datetick</span>
0342 <span class="comment">%</span>
0343 <span class="comment">%     figure; plot(q,-dqdt,'-o');legend('obs');</span>
0344 <span class="comment">%     figure; plot(qfit,dqfit,'-o'); legend('fit function');</span>
0345 <span class="comment">%     figure; plot(q,-dqtst,'-o'); legend('fit test');</span>
0346 
0347 <span class="comment">%abl         = bfra_quickfit(q,dqdt,'lin');</span>
0348 <span class="comment">%[q,dqdt]    = bfra_Qlin(a,b,Q0,t)</span></pre></div>
</body>
</html>