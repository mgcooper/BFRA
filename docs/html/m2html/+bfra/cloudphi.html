<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of cloudphi</title>
  <meta name="keywords" content="cloudphi">
  <meta name="description" content="CLOUDPHI estimate drainable porosity phi from the point cloud">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../function_index.html">Home</a> &gt;  <a href="function_index.html">+bfra</a> &gt; cloudphi.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../function_index.html"><img alt="<" border="0" src="../html_img/left.png">&nbsp;Master index</a></td>
<td align="right"><a href="function_index.html">Index for +bfra&nbsp;<img alt=">" border="0" src="../html_img/right.png"></a></td></tr></table>-->

<h1>cloudphi
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../html_img/up.png"></a></h2>
<div class="box"><strong>CLOUDPHI estimate drainable porosity phi from the point cloud</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../html_img/up.png"></a></h2>
<div class="box"><strong>function [phi,a] = cloudphi(q,dqdt,blate,A,D,L,method,varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../html_img/up.png"></a></h2>
<div class="fragment"><pre class="comment">CLOUDPHI estimate drainable porosity phi from the point cloud
 
 Syntax
 
     [phi,a] = cloudphi(q,dqdt,blate,A,D,L,method,varargin)
 
 Description
 
     [phi,a] = cloudphi(q,dqdt,blate,A,D,L,method) computes drainable porosity
     from discharge q, first derivative dqdt, aquifer properties area A, depth
     D, and channel length L, and late-time b-value blate for the event-scale
     recession equation -dq/dt = aQ^b, using the method of Troch, Troch, and
     Brutsaert, 1993.
 
 Required inputs
 
     q           discharge (L T^-1, e.g. m d-1 or m^3 d-1)
     dqdt        discharge rate of change (L T^-2)
     blate       late-time b parameter in -dqdt = aq^b (dimensionless)
     A           basin area contributing to baseflow (L^2)
     D           saturated aquifer thickness (L)
     L           active stream length (L)
     method      method for fitting straight line to point cloud. Valid
                 options include 'median','mean','envelope'.
 
 Optional name-value inputs
 
     refqtls     reference quantiles that together define a pivot point
                 through which the straight line must pass. use with method
                 'envelope'.
     mask        logical mask to exclude data
     theta       effective slope of basin contributing area
     isflat      logical flag indicating if horizontal or sloped aquifer
                 solution is applicable
     soln1       optional early-time theoretical solution
     soln2       optional late-time theoretical solution
     dispfit     logical flag indicating whether to plot the result
 
 See also <a href="eventphi.html" class="code" title="function [phi,a] = eventphi(K,Fits,A,D,L,blate,varargin)">eventphi</a>, <a href="fitphi.html" class="code" title="function [phi,solns,desc] = fitphi(a1,a2,b2,A,D,L,varargin)">fitphi</a>, fitdistphi

 Matt Cooper, 04-Nov-2022, https://github.com/mgcooper</pre></div>


<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../html_img/up.png"></a></h2>

This function calls:
<ul style="list-style-image:url(../html_img/matlabicon.gif)">
</ul>


This function is called by:
<ul style="list-style-image:url(../html_img/matlabicon.gif)">
</ul>
<!-- crossreference -->






<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../html_img/up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [phi,a] = cloudphi(q,dqdt,blate,A,D,L,method,varargin)</a>
0002 <span class="comment">%CLOUDPHI estimate drainable porosity phi from the point cloud</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% Syntax</span>
0005 <span class="comment">%</span>
0006 <span class="comment">%     [phi,a] = cloudphi(q,dqdt,blate,A,D,L,method,varargin)</span>
0007 <span class="comment">%</span>
0008 <span class="comment">% Description</span>
0009 <span class="comment">%</span>
0010 <span class="comment">%     [phi,a] = cloudphi(q,dqdt,blate,A,D,L,method) computes drainable porosity</span>
0011 <span class="comment">%     from discharge q, first derivative dqdt, aquifer properties area A, depth</span>
0012 <span class="comment">%     D, and channel length L, and late-time b-value blate for the event-scale</span>
0013 <span class="comment">%     recession equation -dq/dt = aQ^b, using the method of Troch, Troch, and</span>
0014 <span class="comment">%     Brutsaert, 1993.</span>
0015 <span class="comment">%</span>
0016 <span class="comment">% Required inputs</span>
0017 <span class="comment">%</span>
0018 <span class="comment">%     q           discharge (L T^-1, e.g. m d-1 or m^3 d-1)</span>
0019 <span class="comment">%     dqdt        discharge rate of change (L T^-2)</span>
0020 <span class="comment">%     blate       late-time b parameter in -dqdt = aq^b (dimensionless)</span>
0021 <span class="comment">%     A           basin area contributing to baseflow (L^2)</span>
0022 <span class="comment">%     D           saturated aquifer thickness (L)</span>
0023 <span class="comment">%     L           active stream length (L)</span>
0024 <span class="comment">%     method      method for fitting straight line to point cloud. Valid</span>
0025 <span class="comment">%                 options include 'median','mean','envelope'.</span>
0026 <span class="comment">%</span>
0027 <span class="comment">% Optional name-value inputs</span>
0028 <span class="comment">%</span>
0029 <span class="comment">%     refqtls     reference quantiles that together define a pivot point</span>
0030 <span class="comment">%                 through which the straight line must pass. use with method</span>
0031 <span class="comment">%                 'envelope'.</span>
0032 <span class="comment">%     mask        logical mask to exclude data</span>
0033 <span class="comment">%     theta       effective slope of basin contributing area</span>
0034 <span class="comment">%     isflat      logical flag indicating if horizontal or sloped aquifer</span>
0035 <span class="comment">%                 solution is applicable</span>
0036 <span class="comment">%     soln1       optional early-time theoretical solution</span>
0037 <span class="comment">%     soln2       optional late-time theoretical solution</span>
0038 <span class="comment">%     dispfit     logical flag indicating whether to plot the result</span>
0039 <span class="comment">%</span>
0040 <span class="comment">% See also eventphi, fitphi, fitdistphi</span>
0041 <span class="comment">%</span>
0042 <span class="comment">% Matt Cooper, 04-Nov-2022, https://github.com/mgcooper</span>
0043 
0044 <span class="comment">% if called with no input, open this file</span>
0045 <span class="keyword">if</span> nargin == 0; open(mfilename(<span class="string">'fullpath'</span>)); <span class="keyword">return</span>; <span class="keyword">end</span>
0046 
0047 <span class="comment">%-------------------------------------------------------------------------------</span>
0048 p                 = inputParser;
0049 p.StructExpand    = false;
0050 p.PartialMatching = true;
0051 p.FunctionName    = <span class="string">'bfra.cloudphi'</span>;
0052 
0053 addRequired(p, <span class="string">'q'</span>,                       @(x)isnumeric(x)  );
0054 addRequired(p, <span class="string">'dqdt'</span>,                    @(x)isnumeric(x)  );
0055 addRequired(p, <span class="string">'blate'</span>,                   @(x)isnumeric(x)  );
0056 addRequired(p, <span class="string">'A'</span>,                       @(x)isnumeric(x)  );
0057 addRequired(p, <span class="string">'D'</span>,                       @(x)isnumeric(x)  );
0058 addRequired(p, <span class="string">'L'</span>,                       @(x)isnumeric(x)  );
0059 addRequired(p, <span class="string">'method'</span>,                  @(x)ischar(x)     );
0060 addParameter(p,<span class="string">'earlyqtls'</span>,[0.95 0.95],   @(x)isnumeric(x)  );
0061 addParameter(p,<span class="string">'lateqtls'</span>, [0.5 0.5],     @(x)isnumeric(x)  );
0062 addParameter(p,<span class="string">'userab'</span>,   nan,           @(x)isnumeric(x)  );
0063 addParameter(p,<span class="string">'mask'</span>,     true(size(q)), @(x)islogical(x)  );
0064 addParameter(p,<span class="string">'theta'</span>,    0,             @(x)isnumeric(x)  );
0065 addParameter(p,<span class="string">'isflat'</span>,   true,          @(x)islogical(x)  );
0066 addParameter(p,<span class="string">'soln1'</span>,    <span class="string">'RS05'</span>,        @(x)ischar(x)     );
0067 addParameter(p,<span class="string">'soln2'</span>,    <span class="string">'RS05'</span>,        @(x)ischar(x)     );
0068 addParameter(p,<span class="string">'dispfit'</span>,  false,         @(x)islogical(x)  );
0069 
0070 parse(p,q,dqdt,blate,A,D,L,method,varargin{:});
0071 
0072 earlyqtls   = p.Results.earlyqtls;
0073 lateqtls    = p.Results.lateqtls;
0074 userab      = p.Results.userab;
0075 mask        = p.Results.mask;
0076 theta       = p.Results.theta;
0077 isflat      = p.Results.isflat;
0078 soln1       = p.Results.soln1;
0079 soln2       = p.Results.soln2;
0080 dispfit     = p.Results.dispfit;
0081 
0082 <span class="comment">%-------------------------------------------------------------------------------</span>
0083 
0084 <span class="comment">% note: the method used for ahat = pointcloudintercept should also be used here</span>
0085 
0086 <span class="comment">% the easiest way to get a1/a2 is pointcloudintercept. bfra.fitab could also be</span>
0087 <span class="comment">% used but this function is intended to fit phi once b is known (or prescribed)</span>
0088 
0089 <span class="comment">% a1 = early-time a</span>
0090 <span class="comment">% b1 = 3 (not involved)</span>
0091 <span class="comment">% a2 = late-time a</span>
0092 <span class="comment">% b2 = late-time b (bhat or theoretical solution b=1 or b=3/2)</span>
0093 
0094 <span class="keyword">if</span> isnan(userab)
0095    b2 = blate; 
0096    a1 = bfra.pointcloudintercept(q,dqdt,3,<span class="string">'envelope'</span>,<span class="string">'refqtls'</span>,earlyqtls);
0097    a2 = bfra.pointcloudintercept(q,dqdt,b2,method,<span class="string">'refqtls'</span>,lateqtls,<span class="string">'mask'</span>,mask);
0098 <span class="keyword">else</span>
0099    
0100 <span class="keyword">end</span>
0101 
0102 <span class="keyword">switch</span> b2
0103    <span class="keyword">case</span> 1
0104       phi = bfra.fitphi(a1,a2,b2,A,D,L,<span class="string">'isflat'</span>,isflat,<span class="string">'soln1'</span>,<span class="string">'PK62'</span>, <span class="keyword">...</span>
0105                <span class="string">'soln2'</span>,<span class="string">'BS03'</span>,<span class="string">'dispfit'</span>,dispfit);
0106    <span class="keyword">case</span> 3/2
0107       phi = bfra.fitphi(a1,a2,b2,A,D,L,<span class="string">'isflat'</span>,isflat,<span class="string">'soln1'</span>,<span class="string">'PK62'</span>, <span class="keyword">...</span>
0108                <span class="string">'soln2'</span>,<span class="string">'BS04'</span>,<span class="string">'dispfit'</span>,dispfit);
0109    <span class="keyword">otherwise</span>
0110       phi = bfra.fitphi(a1,a2,b2,A,D,L,<span class="string">'isflat'</span>,isflat,<span class="string">'soln1'</span>,<span class="string">'RS05'</span>,  <span class="keyword">...</span>
0111                <span class="string">'soln2'</span>,<span class="string">'RS05'</span>,<span class="string">'dispfit'</span>,dispfit);
0112 <span class="keyword">end</span>
0113 a = a2;
0114 
0115 <span class="comment">% make a dummy handle for the legend and print the value of phi</span>
0116 bfra.pointcloudplot(q,dqdt,<span class="string">'blate'</span>,blate,<span class="string">'mask'</span>,mask,<span class="string">'reflines'</span>, <span class="keyword">...</span>
0117    {<span class="string">'early'</span>,<span class="string">'userfit'</span>},<span class="string">'userab'</span>,[a2 blate],<span class="string">'reflabels'</span>,true);
0118 hdum = plot(0,0,<span class="string">'Color'</span>,<span class="string">'none'</span>,<span class="string">'HandleVisibility'</span>,<span class="string">'off'</span>);
0119 txt = sprintf(<span class="string">'$\\phi_{b=%.2f}=%.3f$'</span>,b2,phi);
0120 legend(hdum,txt,<span class="string">'Interpreter'</span>,<span class="string">'latex'</span>,<span class="string">'Location'</span>,<span class="string">'nw'</span>,<span class="string">'box'</span>,<span class="string">'off'</span>);</pre></div>
</body>
</html>