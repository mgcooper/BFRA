<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of dependencies</title>
  <meta name="keywords" content="dependencies">
  <meta name="description" content="DEPENDENCIES Generate function and product dependencies for function.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../function_index.html">Home</a> &gt;  <a href="function_index.html">+bfra</a> &gt; dependencies.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../function_index.html"><img alt="<" border="0" src="../html_img/left.png">&nbsp;Master index</a></td>
<td align="right"><a href="function_index.html">Index for +bfra&nbsp;<img alt=">" border="0" src="../html_img/right.png"></a></td></tr></table>-->

<h1>dependencies
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../html_img/up.png"></a></h2>
<div class="box"><strong>DEPENDENCIES Generate function and product dependencies for function.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../html_img/up.png"></a></h2>
<div class="box"><strong>function report = dependencies(funcname,option) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../html_img/up.png"></a></h2>
<div class="fragment"><pre class="comment"> DEPENDENCIES Generate function and product dependencies for function.

  Input
     funcname = char of any function name

  Output
     funclist = table with column of all functions that input funcname
     depends on, the functions that each of those depends on, and the
     products that each of those depends on.

 See also: Setup</pre></div>


<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../html_img/up.png"></a></h2>

This function calls:
<ul style="list-style-image:url(../html_img/matlabicon.gif)">

<li><a href="open.html" class="code" title="function open(varargin)">open</a>	OPEN Open package namespace function file in the MATLAB Editor.</li></ul>


This function is called by:
<ul style="list-style-image:url(../html_img/matlabicon.gif)">
</ul>
<!-- crossreference -->


<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../html_img/up.png"></a></h2>
<ul style="list-style-image:url(../html_img/matlabicon.gif)">

<li><a href="#_sub1" class="code">function report = getdependencyreport(funclist,prodlist,funcname)</a></li>
<li><a href="#_sub2" class="code">function report = dependencycheck</a></li>
<li><a href="#_sub3" class="code">function report = getmissingdependencies(funclist,funcname)</a></li>
<li><a href="#_sub4" class="code">function report = resolvedependencies(funclist,funcname)</a></li></ul>



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../html_img/up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function report = dependencies(funcname,option)</a>
0002    <span class="comment">% DEPENDENCIES Generate function and product dependencies for function.</span>
0003    <span class="comment">%</span>
0004    <span class="comment">%  Input</span>
0005    <span class="comment">%     funcname = char of any function name</span>
0006    <span class="comment">%</span>
0007    <span class="comment">%  Output</span>
0008    <span class="comment">%     funclist = table with column of all functions that input funcname</span>
0009    <span class="comment">%     depends on, the functions that each of those depends on, and the</span>
0010    <span class="comment">%     products that each of those depends on.</span>
0011    <span class="comment">%</span>
0012    <span class="comment">% See also: Setup</span>
0013 
0014    <span class="comment">% use this to generate a list of all functions in the package, then cycle over</span>
0015    <span class="comment">% all of them and find the dependencies</span>
0016    <span class="comment">% funcpath = fileparts(which('bfra.fitab'));</span>
0017    <span class="comment">% funclist = getlist(funcpath,'.m');</span>
0018 
0019    <span class="comment">% if called with no input, open this file</span>
0020    <span class="keyword">if</span> nargin == 0; <a href="open.html" class="code" title="function open(varargin)">open</a>(mfilename(<span class="string">'fullpath'</span>)); <span class="keyword">return</span>; <span class="keyword">end</span>
0021 
0022    <span class="comment">% valid options</span>
0023    validopts = [&quot;all&quot;,&quot;missing&quot;,&quot;installed&quot;,&quot;resolve&quot;,&quot;report&quot;,&quot;check&quot;];
0024    <span class="keyword">for</span> n = 1:numel(validopts)
0025       opts.(validopts(n)) = option == validopts(n);
0026    <span class="keyword">end</span>
0027 
0028    <span class="comment">% use this to test a particular function</span>
0029    <span class="comment">% if nargin == 0</span>
0030    <span class="comment">% funcname = 'bfra_demo.mlx';</span>
0031    <span class="comment">% funcname = 'bfra_gettingStarted.m';</span>
0032    <span class="comment">% funcname = 'bfra.fitab';</span>
0033    <span class="comment">% funcname = 'bfra_kuparuk.m';</span>
0034    <span class="comment">% end</span>
0035 
0036    <span class="comment">% this loads the saved dependencies.mat file and checks against util/</span>
0037    <span class="keyword">if</span> opts.check == true
0038       report = <a href="#_sub2" class="code" title="subfunction report = dependencycheck">dependencycheck</a>();
0039       <span class="keyword">return</span>;
0040    <span class="keyword">end</span>
0041 
0042    funcpath = fileparts(which(funcname));
0043    [funclist,prodlist] = matlab.codetools.requiredFilesAndProducts(funcname);
0044    funclist = transpose(funclist);
0045    prodlist = transpose(prodlist);
0046 
0047    <span class="keyword">if</span> opts.all == true
0048       <span class="comment">% return a table of all dependencies</span>
0049       report = cell2table(funclist,<span class="string">'VariableNames'</span>,{<span class="string">'function_dependencies'</span>});
0050    <span class="keyword">elseif</span> opts.report == true
0051       report = <a href="#_sub1" class="code" title="subfunction report = getdependencyreport(funclist,prodlist,funcname)">getdependencyreport</a>(funclist,prodlist,funcname);
0052    <span class="keyword">elseif</span> opts.missing == true
0053       report = <a href="#_sub3" class="code" title="subfunction report = getmissingdependencies(funclist,funcname)">getmissingdependencies</a>(funclist,funcname);
0054    <span class="keyword">elseif</span> opts.installed == true
0055       report = getinstalleddependencies(funclist);
0056    <span class="keyword">elseif</span> opts.resolve == true
0057       report = <a href="#_sub4" class="code" title="subfunction report = resolvedependencies(funclist,funcname)">resolvedependencies</a>(funclist,funcname);
0058    <span class="keyword">end</span>
0059 <span class="keyword">end</span>
0060 
0061 <a name="_sub1" href="#_subfunctions" class="code">function report = getdependencyreport(funclist,prodlist,funcname)</a>
0062 
0063    <span class="comment">% get a list of dependencies that are not toolbox functions, i.e. those that</span>
0064    <span class="comment">% need to be included in util/</span>
0065    <span class="comment">% report = funclist;</span>
0066    skip = {<span class="string">'+bfra'</span>,funcname,<span class="string">'ExtractNameVal'</span>,<span class="string">'Cupid'</span>};
0067    keep = true(numel(funclist),1);
0068    <span class="keyword">for</span> n = 1:numel(funclist)
0069       keep(n) = ~ismember(funclist{n},skip);
0070    <span class="keyword">end</span>
0071    report.function_dependencies = funclist(keep);
0072    report.product_dependencies = prodlist;
0073    <span class="comment">% report = report(keep);</span>
0074 <span class="keyword">end</span>
0075 
0076 <a name="_sub2" href="#_subfunctions" class="code">function report = dependencycheck</a>
0077    load(fullfile(getinstallpath(), <span class="string">'+bfra'</span>, <span class="string">'private'</span>, <span class="string">'dependencies.mat'</span>), <span class="string">'report'</span>)
0078    deps = report.function_dependencies;
0079    deps = deps(~isfile(fullfile(getinstallpath(), <span class="string">'util'</span>, deps)));
0080    deps = deps(~isfolder(strrep(fullfile(getinstallpath(), <span class="string">'util'</span>, deps),<span class="string">'.m'</span>,<span class="string">''</span>)));
0081    <span class="comment">% convert to table and return</span>
0082    <span class="keyword">if</span> isempty(deps)
0083       report.missing_dependencies = <span class="string">'all dependencies are installed'</span>;
0084    <span class="keyword">else</span>
0085       report.missing_dependencies = deps;
0086    <span class="keyword">end</span>
0087 <span class="keyword">end</span>
0088 
0089 <a name="_sub3" href="#_subfunctions" class="code">function report = getmissingdependencies(funclist,funcname)</a>
0090 
0091    <span class="comment">% remove functions in the toolbox first, leave the ones in util/ so they can be</span>
0092    <span class="comment">% compared here if needed for debugging.</span>
0093    missing = funclist;
0094    <span class="comment">% Also remove the 'cupid' toolbox and 'ExtractNameVal' functions that get</span>
0095    <span class="comment">% picked up as dependent but are not. What remains after this is functions that</span>
0096    <span class="comment">% are either in util/ or need to be moved there.</span>
0097    skip = {<span class="string">'+bfra'</span>,funcname,<span class="string">'ExtractNameVal'</span>,<span class="string">'Cupid'</span>};
0098    keep = true(numel(missing),1);
0099    <span class="keyword">for</span> n = 1:numel(missing)
0100       keep(n) = ~ismember(missing{n},skip);
0101    <span class="keyword">end</span>
0102    missing = missing(keep);
0103 
0104    <span class="comment">% now remove ones that are in util.</span>
0105    skip = {<span class="string">'bfra/util'</span>};
0106    keep = true(numel(missing),1);
0107    <span class="keyword">for</span> n = 1:numel(missing)
0108       keep(n) = ~ismember(missing{n},skip);
0109    <span class="keyword">end</span>
0110    missing = missing(keep);
0111 
0112    <span class="comment">% % since I use addpath(...,'-end'), the dependency check finds functions in my</span>
0113    <span class="comment">% main function folder not the ones in bfra/util.</span>
0114    <span class="comment">% % now check if funclist ismember paths to versions elsewhere that are in util .</span>
0115    <span class="comment">% % what remains are missing.</span>
0116    keep = true(numel(missing),1);
0117    <span class="keyword">for</span> n = 1:numel(missing)
0118       [~,funcname] = fileparts(missing{n});
0119       allfuncs = which(funcname,<span class="string">'-all'</span>);
0120       <span class="keyword">if</span> any(ismember(allfuncs,fullfile(<span class="string">'bfra'</span>,<span class="string">'util'</span>,funcname)))
0121          keep(n) = false;
0122       <span class="keyword">end</span>
0123    <span class="keyword">end</span>
0124    missing = missing(keep);
0125 
0126    <span class="comment">% convert to table and return</span>
0127    report.function_dependencies = funclist;
0128    <span class="keyword">if</span> isempty(missing)
0129       report.missing_dependencies = <span class="string">'all dependencies are installed'</span>;
0130    <span class="keyword">else</span>
0131       report.missing_dependencies = missing;
0132    <span class="keyword">end</span>
0133 <span class="keyword">end</span>
0134 
0135 <span class="comment">%% internal use</span>
0136 <a name="_sub4" href="#_subfunctions" class="code">function report = resolvedependencies(funclist,funcname)</a>
0137 
0138    <span class="comment">% cycle through the dependent functions and copy them to util/</span>
0139 
0140    <span class="comment">% NOTE: this is for private use, it won't work if you don't have the functions</span>
0141    <span class="comment">% on your local computer. Please contact me at matt.cooper@pnnl.gov if you have</span>
0142    <span class="comment">% any trouble running this toolbox or if any function dependencies are missing</span>
0143    <span class="comment">% from the toolbox. Alternatively, look for the missing functions in</span>
0144    <span class="comment">% https://github.com/mgcooper/matfunclib (I suggest the dev branch). Thank you.</span>
0145 
0146    <span class="comment">% TODO: add method to clone from https://github.com/mgcooper/matfunclib</span>
0147 
0148    report = <a href="#_sub3" class="code" title="subfunction report = getmissingdependencies(funclist,funcname)">getmissingdependencies</a>(funclist,funcname);
0149 
0150    <span class="keyword">if</span> ischar(report.missing_dependencies) &amp;&amp; <span class="keyword">...</span>
0151          strcmp(report.missing_dependencies,<span class="string">'all dependencies are installed'</span>)
0152       <span class="keyword">return</span>
0153    <span class="keyword">else</span>
0154       <span class="keyword">for</span> n = 1:numel(report.missing_dependencies)
0155          [~,fname,ext] = fileparts(report.missing_dependencies{n});
0156          destpath = fullfile(getinstallpath(),<span class="string">'util'</span>,[fname,ext]);
0157          copyfile(report.missing_dependencies{n},destpath);
0158       <span class="keyword">end</span>
0159    <span class="keyword">end</span>
0160 
0161    <span class="comment">% any functions listed in dependentFunctions may be required for some fringe</span>
0162    <span class="comment">% behavior in the toolbox but the core functionality should</span>
0163 
0164    <span class="comment">%%</span>
0165    <span class="comment">% if the commented loop in bfra.dependencies.m is used, this is required</span>
0166    <span class="comment">% dependentFunctions = unique(vertcat(allDependencies.function_dependencies{:}));</span>
0167 
0168    <span class="comment">% % nearly certain it isn't necessary to cycle over all functions, I may have</span>
0169    <span class="comment">% added this to figure out which functions were responsible for some functions</span>
0170    <span class="comment">% that were returned as required but sholdn't be like the Cupid toolbox</span>
0171 
0172    <span class="comment">% Depends = cell(numel(funclist),3);</span>
0173    <span class="comment">% for n = 1:numel(funclist)</span>
0174    <span class="comment">%</span>
0175    <span class="comment">%    % this is needed if getlist is used</span>
0176    <span class="comment">%    % thisfunc = [funcpath filesep funclist(n).name];</span>
0177    <span class="comment">%</span>
0178    <span class="comment">%    thisfunc = funclist{n};</span>
0179    <span class="comment">%    [fl,pl] = matlab.codetools.requiredFilesAndProducts(thisfunc);</span>
0180    <span class="comment">%    fl = transpose(fl);</span>
0181    <span class="comment">%</span>
0182    <span class="comment">%    Depends{n,1} = thisfunc;</span>
0183    <span class="comment">%    Depends{n,2} = fl;</span>
0184    <span class="comment">%    Depends{n,3} = {pl(:).Name}';</span>
0185    <span class="comment">%</span>
0186    <span class="comment">% end</span>
0187    <span class="comment">%</span>
0188    <span class="comment">% Depends = cell2table(Depends,'VariableNames',...</span>
0189    <span class="comment">%    {'function_name','function_dependencies','product_dependencies'});</span>
0190 
0191 <span class="keyword">end</span></pre></div>
</body>
</html>